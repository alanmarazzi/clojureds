;; gorilla-repl.fileformat = 1

;; **
;;; # Chapter 9 - Time Series
;; **

;; @@
(ns ch9.ws
  (:require [gorilla-plot.core :as plot]
            [incanter.charts :as c]
            [incanter.core :as i ]
            [incanter.datasets :as d]
            [incanter.stats :as s]
            [incanter.svg :as svg]
			[succession.core :as sc]
            [clojure.pprint :as pp]
            [huri.plot :as plt]
            [clj-time.format :as tf]))
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-nil'>nil</span>","value":"nil"}
;; <=

;; @@
(->> (d/get-dataset :longley)
     :rows
     (pp/print-table))
;; @@
;; ->
;;; 
;;; |    :y |   :x1 |    :x2 |  :x3 |  :x4 |    :x5 |  :x6 |
;;; |-------+-------+--------+------+------+--------+------|
;;; | 60323 |  83.0 | 234289 | 2356 | 1590 | 107608 | 1947 |
;;; | 61122 |  88.5 | 259426 | 2325 | 1456 | 108632 | 1948 |
;;; | 60171 |  88.2 | 258054 | 3682 | 1616 | 109773 | 1949 |
;;; | 61187 |  89.5 | 284599 | 3351 | 1650 | 110929 | 1950 |
;;; | 63221 |  96.2 | 328975 | 2099 | 3099 | 112075 | 1951 |
;;; | 63639 |  98.1 | 346999 | 1932 | 3594 | 113270 | 1952 |
;;; | 64989 |  99.0 | 365385 | 1870 | 3547 | 115094 | 1953 |
;;; | 63761 | 100.0 | 363112 | 3578 | 3350 | 116219 | 1954 |
;;; | 66019 | 101.2 | 397469 | 2904 | 3048 | 117388 | 1955 |
;;; | 67857 | 104.6 | 419180 | 2822 | 2857 | 118734 | 1956 |
;;; | 68169 | 108.4 | 442769 | 2936 | 2798 | 120445 | 1957 |
;;; | 66513 | 110.8 | 444546 | 4681 | 2637 | 121950 | 1958 |
;;; | 68655 | 112.6 | 482704 | 3813 | 2552 | 123366 | 1959 |
;;; | 69564 | 114.2 | 502601 | 3931 | 2514 | 125368 | 1960 |
;;; | 69331 | 115.7 | 518173 | 4806 | 2572 | 127852 | 1961 |
;;; | 70551 | 116.9 | 554894 | 4007 | 2827 | 130081 | 1962 |
;;; 
;; <-
;; =>
;;; {"type":"html","content":"<span class='clj-nil'>nil</span>","value":"nil"}
;; <=

;; @@
(def longley (d/get-dataset :longley))
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-var'>#&#x27;ch9.ws/longley</span>","value":"#'ch9.ws/longley"}
;; <=

;; **
;;; The **Longley** dataset contains data about 7 economic variables measured in the US between 1947 and 1962. We care about the last 3 cols: 
;;; 
;;; - **x4**: size of armed forces
;;; - **x5**: population 14+
;;; - **x6**: the year
;;; 
;;; To begin we see how population grows during time
;; **

;; @@
(let [data (:rows longley)]
  (as-> data d
        (map (juxt :x6 :x5) d)
        (plot/list-plot d :plot-size 600)))
;; @@
;; =>
;;; {"type":"vega","content":{"width":600,"height":370.82818603515625,"padding":{"top":10,"left":55,"bottom":40,"right":10},"data":[{"name":"a5aa8af3-c359-4ba0-aa50-1997b723097d","values":[{"x":1947,"y":107608},{"x":1948,"y":108632},{"x":1949,"y":109773},{"x":1950,"y":110929},{"x":1951,"y":112075},{"x":1952,"y":113270},{"x":1953,"y":115094},{"x":1954,"y":116219},{"x":1955,"y":117388},{"x":1956,"y":118734},{"x":1957,"y":120445},{"x":1958,"y":121950},{"x":1959,"y":123366},{"x":1960,"y":125368},{"x":1961,"y":127852},{"x":1962,"y":130081}]}],"marks":[{"type":"symbol","from":{"data":"a5aa8af3-c359-4ba0-aa50-1997b723097d"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"fill":{"value":"steelblue"},"fillOpacity":{"value":1}},"update":{"shape":"circle","size":{"value":70},"stroke":{"value":"transparent"}},"hover":{"size":{"value":210},"stroke":{"value":"white"}}}}],"scales":[{"name":"x","type":"linear","range":"width","zero":false,"domain":{"data":"a5aa8af3-c359-4ba0-aa50-1997b723097d","field":"data.x"}},{"name":"y","type":"linear","range":"height","nice":true,"zero":false,"domain":{"data":"a5aa8af3-c359-4ba0-aa50-1997b723097d","field":"data.y"}}],"axes":[{"type":"x","scale":"x"},{"type":"y","scale":"y"}]},"value":"#gorilla_repl.vega.VegaView{:content {:width 600, :height 370.8282, :padding {:top 10, :left 55, :bottom 40, :right 10}, :data [{:name \"a5aa8af3-c359-4ba0-aa50-1997b723097d\", :values ({:x 1947, :y 107608} {:x 1948, :y 108632} {:x 1949, :y 109773} {:x 1950, :y 110929} {:x 1951, :y 112075} {:x 1952, :y 113270} {:x 1953, :y 115094} {:x 1954, :y 116219} {:x 1955, :y 117388} {:x 1956, :y 118734} {:x 1957, :y 120445} {:x 1958, :y 121950} {:x 1959, :y 123366} {:x 1960, :y 125368} {:x 1961, :y 127852} {:x 1962, :y 130081})}], :marks [{:type \"symbol\", :from {:data \"a5aa8af3-c359-4ba0-aa50-1997b723097d\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :fill {:value \"steelblue\"}, :fillOpacity {:value 1}}, :update {:shape \"circle\", :size {:value 70}, :stroke {:value \"transparent\"}}, :hover {:size {:value 210}, :stroke {:value \"white\"}}}}], :scales [{:name \"x\", :type \"linear\", :range \"width\", :zero false, :domain {:data \"a5aa8af3-c359-4ba0-aa50-1997b723097d\", :field \"data.x\"}} {:name \"y\", :type \"linear\", :range \"height\", :nice true, :zero false, :domain {:data \"a5aa8af3-c359-4ba0-aa50-1997b723097d\", :field \"data.y\"}}], :axes [{:type \"x\", :scale \"x\"} {:type \"y\", :scale \"y\"}]}}"}
;; <=

;; @@
(let [data longley
      rows (:rows data)
      model (s/linear-model (i/$ :x5 data)
                            (i/$ :x6 data))
      fitted (:fitted model)
      r-square (:r-square model)
      l (partition 2 (interleave (map :x6 rows) fitted))
      d (map (juxt :x6 :x5) rows)]
  (println "R^2" r-square)
  (plot/compose
    (plot/list-plot d :plot-size 600)
    (plot/list-plot l :joined true :plot-size 600)))
;; @@
;; ->
;;; R^2 0.9879422605343007
;;; 
;; <-
;; =>
;;; {"type":"vega","content":{"width":600,"height":370.82818603515625,"padding":{"top":10,"left":55,"bottom":40,"right":10},"scales":[{"name":"x","type":"linear","range":"width","zero":false,"domain":{"data":"c5907c2d-d17c-49a4-9fa3-d57caf41a97b","field":"data.x"}},{"name":"y","type":"linear","range":"height","nice":true,"zero":false,"domain":{"data":"c5907c2d-d17c-49a4-9fa3-d57caf41a97b","field":"data.y"}}],"axes":[{"type":"x","scale":"x"},{"type":"y","scale":"y"}],"data":[{"name":"c5907c2d-d17c-49a4-9fa3-d57caf41a97b","values":[{"x":1947,"y":107608},{"x":1948,"y":108632},{"x":1949,"y":109773},{"x":1950,"y":110929},{"x":1951,"y":112075},{"x":1952,"y":113270},{"x":1953,"y":115094},{"x":1954,"y":116219},{"x":1955,"y":117388},{"x":1956,"y":118734},{"x":1957,"y":120445},{"x":1958,"y":121950},{"x":1959,"y":123366},{"x":1960,"y":125368},{"x":1961,"y":127852},{"x":1962,"y":130081}]},{"name":"8984aa3d-4163-420c-aad9-177633c2e1e6","values":[{"x":1947,"y":106532.21323443949},{"x":1948,"y":107984.45146971941},{"x":1949,"y":109436.68970499933},{"x":1950,"y":110888.92794027925},{"x":1951,"y":112341.16617555916},{"x":1952,"y":113793.40441083908},{"x":1953,"y":115245.642646119},{"x":1954,"y":116697.88088139892},{"x":1955,"y":118150.11911667883},{"x":1956,"y":119602.35735195875},{"x":1957,"y":121054.59558723867},{"x":1958,"y":122506.83382251859},{"x":1959,"y":123959.0720577985},{"x":1960,"y":125411.31029307842},{"x":1961,"y":126863.54852835834},{"x":1962,"y":128315.78676363826}]}],"marks":[{"type":"symbol","from":{"data":"c5907c2d-d17c-49a4-9fa3-d57caf41a97b"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"fill":{"value":"steelblue"},"fillOpacity":{"value":1}},"update":{"shape":"circle","size":{"value":70},"stroke":{"value":"transparent"}},"hover":{"size":{"value":210},"stroke":{"value":"white"}}}},{"type":"line","from":{"data":"8984aa3d-4163-420c-aad9-177633c2e1e6"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"#FF29D2"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}}]},"value":"#gorilla_repl.vega.VegaView{:content {:width 600, :height 370.8282, :padding {:top 10, :left 55, :bottom 40, :right 10}, :scales [{:name \"x\", :type \"linear\", :range \"width\", :zero false, :domain {:data \"c5907c2d-d17c-49a4-9fa3-d57caf41a97b\", :field \"data.x\"}} {:name \"y\", :type \"linear\", :range \"height\", :nice true, :zero false, :domain {:data \"c5907c2d-d17c-49a4-9fa3-d57caf41a97b\", :field \"data.y\"}}], :axes [{:type \"x\", :scale \"x\"} {:type \"y\", :scale \"y\"}], :data ({:name \"c5907c2d-d17c-49a4-9fa3-d57caf41a97b\", :values ({:x 1947, :y 107608} {:x 1948, :y 108632} {:x 1949, :y 109773} {:x 1950, :y 110929} {:x 1951, :y 112075} {:x 1952, :y 113270} {:x 1953, :y 115094} {:x 1954, :y 116219} {:x 1955, :y 117388} {:x 1956, :y 118734} {:x 1957, :y 120445} {:x 1958, :y 121950} {:x 1959, :y 123366} {:x 1960, :y 125368} {:x 1961, :y 127852} {:x 1962, :y 130081})} {:name \"8984aa3d-4163-420c-aad9-177633c2e1e6\", :values ({:x 1947, :y 106532.21323443949} {:x 1948, :y 107984.45146971941} {:x 1949, :y 109436.68970499933} {:x 1950, :y 110888.92794027925} {:x 1951, :y 112341.16617555916} {:x 1952, :y 113793.40441083908} {:x 1953, :y 115245.642646119} {:x 1954, :y 116697.88088139892} {:x 1955, :y 118150.11911667883} {:x 1956, :y 119602.35735195875} {:x 1957, :y 121054.59558723867} {:x 1958, :y 122506.83382251859} {:x 1959, :y 123959.0720577985} {:x 1960, :y 125411.31029307842} {:x 1961, :y 126863.54852835834} {:x 1962, :y 128315.78676363826})}), :marks ({:type \"symbol\", :from {:data \"c5907c2d-d17c-49a4-9fa3-d57caf41a97b\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :fill {:value \"steelblue\"}, :fillOpacity {:value 1}}, :update {:shape \"circle\", :size {:value 70}, :stroke {:value \"transparent\"}}, :hover {:size {:value 210}, :stroke {:value \"white\"}}}} {:type \"line\", :from {:data \"8984aa3d-4163-420c-aad9-177633c2e1e6\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"#FF29D2\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}})}}"}
;; <=

;; @@
(let [x (i/$ :x6 longley)
      xs (i/bind-columns x (i/sq x))
      model (s/linear-model (i/$ :x5 longley) xs)
      fitted (:fitted model)
      l (partition 2 (interleave (map :x6 (:rows longley)) fitted))
      d (map (juxt :x6 :x5) (:rows longley))]
  (println "R^2" (:r-square model))
  (plot/compose
    (plot/list-plot d :plot-size 600)
    (plot/list-plot l :joined true)))
;; @@
;; ->
;;; R^2 0.9982597484826498
;;; 
;; <-
;; =>
;;; {"type":"vega","content":{"width":600,"height":370.82818603515625,"padding":{"top":10,"left":55,"bottom":40,"right":10},"scales":[{"name":"x","type":"linear","range":"width","zero":false,"domain":{"data":"ad6deff3-0444-4738-a10d-afae15794124","field":"data.x"}},{"name":"y","type":"linear","range":"height","nice":true,"zero":false,"domain":{"data":"ad6deff3-0444-4738-a10d-afae15794124","field":"data.y"}}],"axes":[{"type":"x","scale":"x"},{"type":"y","scale":"y"}],"data":[{"name":"ad6deff3-0444-4738-a10d-afae15794124","values":[{"x":1947,"y":107608},{"x":1948,"y":108632},{"x":1949,"y":109773},{"x":1950,"y":110929},{"x":1951,"y":112075},{"x":1952,"y":113270},{"x":1953,"y":115094},{"x":1954,"y":116219},{"x":1955,"y":117388},{"x":1956,"y":118734},{"x":1957,"y":120445},{"x":1958,"y":121950},{"x":1959,"y":123366},{"x":1960,"y":125368},{"x":1961,"y":127852},{"x":1962,"y":130081}]},{"name":"fada492a-bfe4-44f7-8c8d-d5c99de99d8e","values":[{"x":1947,"y":107803.7575416565},{"x":1948,"y":108749.07135009766},{"x":1949,"y":109766.80289077759},{"x":1950,"y":110856.95216369629},{"x":1951,"y":112019.51916885376},{"x":1952,"y":113254.50390625},{"x":1953,"y":114561.90637588501},{"x":1954,"y":115941.72657775879},{"x":1955,"y":117393.96451187134},{"x":1956,"y":118918.62017822266},{"x":1957,"y":120515.69357681274},{"x":1958,"y":122185.1847076416},{"x":1959,"y":123927.09357070923},{"x":1960,"y":125741.42016601562},{"x":1961,"y":127628.16449356079},{"x":1962,"y":129587.32655334473}]}],"marks":[{"type":"symbol","from":{"data":"ad6deff3-0444-4738-a10d-afae15794124"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"fill":{"value":"steelblue"},"fillOpacity":{"value":1}},"update":{"shape":"circle","size":{"value":70},"stroke":{"value":"transparent"}},"hover":{"size":{"value":210},"stroke":{"value":"white"}}}},{"type":"line","from":{"data":"fada492a-bfe4-44f7-8c8d-d5c99de99d8e"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"#FF29D2"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}}]},"value":"#gorilla_repl.vega.VegaView{:content {:width 600, :height 370.8282, :padding {:top 10, :left 55, :bottom 40, :right 10}, :scales [{:name \"x\", :type \"linear\", :range \"width\", :zero false, :domain {:data \"ad6deff3-0444-4738-a10d-afae15794124\", :field \"data.x\"}} {:name \"y\", :type \"linear\", :range \"height\", :nice true, :zero false, :domain {:data \"ad6deff3-0444-4738-a10d-afae15794124\", :field \"data.y\"}}], :axes [{:type \"x\", :scale \"x\"} {:type \"y\", :scale \"y\"}], :data ({:name \"ad6deff3-0444-4738-a10d-afae15794124\", :values ({:x 1947, :y 107608} {:x 1948, :y 108632} {:x 1949, :y 109773} {:x 1950, :y 110929} {:x 1951, :y 112075} {:x 1952, :y 113270} {:x 1953, :y 115094} {:x 1954, :y 116219} {:x 1955, :y 117388} {:x 1956, :y 118734} {:x 1957, :y 120445} {:x 1958, :y 121950} {:x 1959, :y 123366} {:x 1960, :y 125368} {:x 1961, :y 127852} {:x 1962, :y 130081})} {:name \"fada492a-bfe4-44f7-8c8d-d5c99de99d8e\", :values ({:x 1947, :y 107803.7575416565} {:x 1948, :y 108749.07135009766} {:x 1949, :y 109766.80289077759} {:x 1950, :y 110856.95216369629} {:x 1951, :y 112019.51916885376} {:x 1952, :y 113254.50390625} {:x 1953, :y 114561.90637588501} {:x 1954, :y 115941.72657775879} {:x 1955, :y 117393.96451187134} {:x 1956, :y 118918.62017822266} {:x 1957, :y 120515.69357681274} {:x 1958, :y 122185.1847076416} {:x 1959, :y 123927.09357070923} {:x 1960, :y 125741.42016601562} {:x 1961, :y 127628.16449356079} {:x 1962, :y 129587.32655334473})}), :marks ({:type \"symbol\", :from {:data \"ad6deff3-0444-4738-a10d-afae15794124\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :fill {:value \"steelblue\"}, :fillOpacity {:value 1}}, :update {:shape \"circle\", :size {:value 70}, :stroke {:value \"transparent\"}}, :hover {:size {:value 210}, :stroke {:value \"white\"}}}} {:type \"line\", :from {:data \"fada492a-bfe4-44f7-8c8d-d5c99de99d8e\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"#FF29D2\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}})}}"}
;; <=

;; @@
(defn forecast
  [coefs]
  (fn [x]
    (first
      (i/mmult (i/trans coefs)
               (i/matrix [1.0 x (i/sq x)])))))
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-var'>#&#x27;ch9.ws/forecast</span>","value":"#'ch9.ws/forecast"}
;; <=

;; @@
(let [x (i/$ :x6 longley)
      xs (i/bind-columns x (i/sq x))
      model (s/linear-model (i/$ :x5 longley) xs)
      d (map (juxt :x6 :x5) (:rows longley))]
  (plot/compose
    (plot/plot #((forecast (:coefs model)) %) [1947 1970] 
               :plot-size 600)
    (plot/list-plot d)))
;; @@
;; =>
;;; {"type":"vega","content":{"width":600,"height":370.82818603515625,"padding":{"top":10,"left":55,"bottom":40,"right":10},"scales":[{"name":"x","type":"linear","range":"width","zero":false,"domain":{"data":"c4abb5ea-775c-4ebc-bd1e-72700cf3735e","field":"data.x"}},{"name":"y","type":"linear","range":"height","nice":true,"zero":false,"domain":{"data":"c4abb5ea-775c-4ebc-bd1e-72700cf3735e","field":"data.y"}}],"axes":[{"type":"x","scale":"x"},{"type":"y","scale":"y"}],"data":[{"name":"c4abb5ea-775c-4ebc-bd1e-72700cf3735e","values":[{"x":1947,"y":107803.7575416565},{"x":1947.2300000041723,"y":108014.76713126898},{"x":1947.4600000083447,"y":108229.60761904716},{"x":1947.690000012517,"y":108448.27900502086},{"x":1947.9200000166893,"y":108670.78128916025},{"x":1948.1500000208616,"y":108897.11447149515},{"x":1948.380000025034,"y":109127.27855196595},{"x":1948.6100000292063,"y":109361.27353063226},{"x":1948.8400000333786,"y":109599.09940746427},{"x":1949.070000037551,"y":109840.75618246198},{"x":1949.3000000417233,"y":110086.2438556552},{"x":1949.5300000458956,"y":110335.56242701411},{"x":1949.760000050068,"y":110588.71189656854},{"x":1949.9900000542402,"y":110845.69226425886},{"x":1950.2200000584126,"y":111106.50353014469},{"x":1950.4500000625849,"y":111371.14569419622},{"x":1950.6800000667572,"y":111639.61875644326},{"x":1950.9100000709295,"y":111911.9227168262},{"x":1951.1400000751019,"y":112188.05757543445},{"x":1951.3700000792742,"y":112468.02333217859},{"x":1951.6000000834465,"y":112751.81998708844},{"x":1951.8300000876188,"y":113039.4475401938},{"x":1952.0600000917912,"y":113330.90599149466},{"x":1952.2900000959635,"y":113626.19534093142},{"x":1952.5200001001358,"y":113925.31558856368},{"x":1952.7500001043081,"y":114228.26673436165},{"x":1952.9800001084805,"y":114535.04877832532},{"x":1953.2100001126528,"y":114845.6617204845},{"x":1953.440000116825,"y":115160.10556080937},{"x":1953.6700001209974,"y":115478.38029932976},{"x":1953.9000001251698,"y":115800.48593598604},{"x":1954.130000129342,"y":116126.42247083783},{"x":1954.3600001335144,"y":116456.18990385532},{"x":1954.5900001376867,"y":116789.78823500872},{"x":1954.820000141859,"y":117127.21746435761},{"x":1955.0500001460314,"y":117468.47759190202},{"x":1955.2800001502037,"y":117813.56861764193},{"x":1955.510000154376,"y":118162.49054151773},{"x":1955.7400001585484,"y":118515.24336358905},{"x":1955.9700001627207,"y":118871.82708382607},{"x":1956.200000166893,"y":119232.24170225859},{"x":1956.4300001710653,"y":119596.48721882701},{"x":1956.6600001752377,"y":119964.56363362074},{"x":1956.89000017941,"y":120336.47094655037},{"x":1957.1200001835823,"y":120712.2091576755},{"x":1957.3500001877546,"y":121091.77826696634},{"x":1957.580000191927,"y":121475.17827442288},{"x":1957.8100001960993,"y":121862.40918007493},{"x":1958.0400002002716,"y":122253.47098386288},{"x":1958.270000204444,"y":122648.36368584633},{"x":1958.5000002086163,"y":123047.08728602529},{"x":1958.7300002127886,"y":123449.64178436995},{"x":1958.960000216961,"y":123856.02718088031},{"x":1959.1900002211332,"y":124266.24347555637},{"x":1959.4200002253056,"y":124680.29066842794},{"x":1959.6500002294779,"y":125098.16875943542},{"x":1959.8800002336502,"y":125519.8777486682},{"x":1960.1100002378225,"y":125945.41763603687},{"x":1960.3400002419949,"y":126374.78842160106},{"x":1960.5700002461672,"y":126807.99010533094},{"x":1960.8000002503395,"y":127245.02268722653},{"x":1961.0300002545118,"y":127685.88616731763},{"x":1961.2600002586842,"y":128130.58054557443},{"x":1961.4900002628565,"y":128579.10582199693},{"x":1961.7200002670288,"y":129031.46199661493},{"x":1961.9500002712011,"y":129487.64906936884},{"x":1962.1800002753735,"y":129947.66704031825},{"x":1962.4100002795458,"y":130411.51590946317},{"x":1962.640000283718,"y":130879.19567674398},{"x":1962.8700002878904,"y":131350.7063422501},{"x":1963.1000002920628,"y":131826.04790589213},{"x":1963.330000296235,"y":132305.22036769986},{"x":1963.5600003004074,"y":132788.2237277031},{"x":1963.7900003045797,"y":133275.05798587203},{"x":1964.020000308752,"y":133765.72314223647},{"x":1964.2500003129244,"y":134260.21919676661},{"x":1964.4800003170967,"y":134758.54614943266},{"x":1964.710000321269,"y":135260.704000324},{"x":1964.9400003254414,"y":135766.69274935126},{"x":1965.1700003296137,"y":136276.51239657402},{"x":1965.400000333786,"y":136790.16294199228},{"x":1965.6300003379583,"y":137307.64438554645},{"x":1965.8600003421307,"y":137828.9567272961},{"x":1966.090000346303,"y":138354.09996721148},{"x":1966.3200003504753,"y":138883.07410529256},{"x":1966.5500003546476,"y":139415.87914156914},{"x":1966.78000035882,"y":139952.51507601142},{"x":1967.0100003629923,"y":140492.9819086194},{"x":1967.2400003671646,"y":141037.2796394229},{"x":1967.470000371337,"y":141585.40826836228},{"x":1967.7000003755093,"y":142137.36779549718},{"x":1967.9300003796816,"y":142693.15822082758},{"x":1968.160000383854,"y":143252.77954432368},{"x":1968.3900003880262,"y":143816.2317659855},{"x":1968.6200003921986,"y":144383.514885813},{"x":1968.850000396371,"y":144954.628903836},{"x":1969.0800004005432,"y":145529.57382002473},{"x":1969.3100004047155,"y":146108.34963437915},{"x":1969.5400004088879,"y":146690.95634683967},{"x":1969.7700004130602,"y":147277.3939575553}]},{"name":"12136f12-18ea-41d1-9916-c0e28a30af3e","values":[{"x":1947,"y":107608},{"x":1948,"y":108632},{"x":1949,"y":109773},{"x":1950,"y":110929},{"x":1951,"y":112075},{"x":1952,"y":113270},{"x":1953,"y":115094},{"x":1954,"y":116219},{"x":1955,"y":117388},{"x":1956,"y":118734},{"x":1957,"y":120445},{"x":1958,"y":121950},{"x":1959,"y":123366},{"x":1960,"y":125368},{"x":1961,"y":127852},{"x":1962,"y":130081}]}],"marks":[{"type":"line","from":{"data":"c4abb5ea-775c-4ebc-bd1e-72700cf3735e"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"#FF29D2"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}},{"type":"symbol","from":{"data":"12136f12-18ea-41d1-9916-c0e28a30af3e"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"fill":{"value":"steelblue"},"fillOpacity":{"value":1}},"update":{"shape":"circle","size":{"value":70},"stroke":{"value":"transparent"}},"hover":{"size":{"value":210},"stroke":{"value":"white"}}}}]},"value":"#gorilla_repl.vega.VegaView{:content {:width 600, :height 370.8282, :padding {:top 10, :left 55, :bottom 40, :right 10}, :scales [{:name \"x\", :type \"linear\", :range \"width\", :zero false, :domain {:data \"c4abb5ea-775c-4ebc-bd1e-72700cf3735e\", :field \"data.x\"}} {:name \"y\", :type \"linear\", :range \"height\", :nice true, :zero false, :domain {:data \"c4abb5ea-775c-4ebc-bd1e-72700cf3735e\", :field \"data.y\"}}], :axes [{:type \"x\", :scale \"x\"} {:type \"y\", :scale \"y\"}], :data ({:name \"c4abb5ea-775c-4ebc-bd1e-72700cf3735e\", :values ({:x 1947, :y 107803.7575416565} {:x 1947.2300000041723, :y 108014.76713126898} {:x 1947.4600000083447, :y 108229.60761904716} {:x 1947.690000012517, :y 108448.27900502086} {:x 1947.9200000166893, :y 108670.78128916025} {:x 1948.1500000208616, :y 108897.11447149515} {:x 1948.380000025034, :y 109127.27855196595} {:x 1948.6100000292063, :y 109361.27353063226} {:x 1948.8400000333786, :y 109599.09940746427} {:x 1949.070000037551, :y 109840.75618246198} {:x 1949.3000000417233, :y 110086.2438556552} {:x 1949.5300000458956, :y 110335.56242701411} {:x 1949.760000050068, :y 110588.71189656854} {:x 1949.9900000542402, :y 110845.69226425886} {:x 1950.2200000584126, :y 111106.50353014469} {:x 1950.4500000625849, :y 111371.14569419622} {:x 1950.6800000667572, :y 111639.61875644326} {:x 1950.9100000709295, :y 111911.9227168262} {:x 1951.1400000751019, :y 112188.05757543445} {:x 1951.3700000792742, :y 112468.02333217859} {:x 1951.6000000834465, :y 112751.81998708844} {:x 1951.8300000876188, :y 113039.4475401938} {:x 1952.0600000917912, :y 113330.90599149466} {:x 1952.2900000959635, :y 113626.19534093142} {:x 1952.5200001001358, :y 113925.31558856368} {:x 1952.7500001043081, :y 114228.26673436165} {:x 1952.9800001084805, :y 114535.04877832532} {:x 1953.2100001126528, :y 114845.6617204845} {:x 1953.440000116825, :y 115160.10556080937} {:x 1953.6700001209974, :y 115478.38029932976} {:x 1953.9000001251698, :y 115800.48593598604} {:x 1954.130000129342, :y 116126.42247083783} {:x 1954.3600001335144, :y 116456.18990385532} {:x 1954.5900001376867, :y 116789.78823500872} {:x 1954.820000141859, :y 117127.21746435761} {:x 1955.0500001460314, :y 117468.47759190202} {:x 1955.2800001502037, :y 117813.56861764193} {:x 1955.510000154376, :y 118162.49054151773} {:x 1955.7400001585484, :y 118515.24336358905} {:x 1955.9700001627207, :y 118871.82708382607} {:x 1956.200000166893, :y 119232.24170225859} {:x 1956.4300001710653, :y 119596.48721882701} {:x 1956.6600001752377, :y 119964.56363362074} {:x 1956.89000017941, :y 120336.47094655037} {:x 1957.1200001835823, :y 120712.2091576755} {:x 1957.3500001877546, :y 121091.77826696634} {:x 1957.580000191927, :y 121475.17827442288} {:x 1957.8100001960993, :y 121862.40918007493} {:x 1958.0400002002716, :y 122253.47098386288} {:x 1958.270000204444, :y 122648.36368584633} {:x 1958.5000002086163, :y 123047.08728602529} {:x 1958.7300002127886, :y 123449.64178436995} {:x 1958.960000216961, :y 123856.02718088031} {:x 1959.1900002211332, :y 124266.24347555637} {:x 1959.4200002253056, :y 124680.29066842794} {:x 1959.6500002294779, :y 125098.16875943542} {:x 1959.8800002336502, :y 125519.8777486682} {:x 1960.1100002378225, :y 125945.41763603687} {:x 1960.3400002419949, :y 126374.78842160106} {:x 1960.5700002461672, :y 126807.99010533094} {:x 1960.8000002503395, :y 127245.02268722653} {:x 1961.0300002545118, :y 127685.88616731763} {:x 1961.2600002586842, :y 128130.58054557443} {:x 1961.4900002628565, :y 128579.10582199693} {:x 1961.7200002670288, :y 129031.46199661493} {:x 1961.9500002712011, :y 129487.64906936884} {:x 1962.1800002753735, :y 129947.66704031825} {:x 1962.4100002795458, :y 130411.51590946317} {:x 1962.640000283718, :y 130879.19567674398} {:x 1962.8700002878904, :y 131350.7063422501} {:x 1963.1000002920628, :y 131826.04790589213} {:x 1963.330000296235, :y 132305.22036769986} {:x 1963.5600003004074, :y 132788.2237277031} {:x 1963.7900003045797, :y 133275.05798587203} {:x 1964.020000308752, :y 133765.72314223647} {:x 1964.2500003129244, :y 134260.21919676661} {:x 1964.4800003170967, :y 134758.54614943266} {:x 1964.710000321269, :y 135260.704000324} {:x 1964.9400003254414, :y 135766.69274935126} {:x 1965.1700003296137, :y 136276.51239657402} {:x 1965.400000333786, :y 136790.16294199228} {:x 1965.6300003379583, :y 137307.64438554645} {:x 1965.8600003421307, :y 137828.9567272961} {:x 1966.090000346303, :y 138354.09996721148} {:x 1966.3200003504753, :y 138883.07410529256} {:x 1966.5500003546476, :y 139415.87914156914} {:x 1966.78000035882, :y 139952.51507601142} {:x 1967.0100003629923, :y 140492.9819086194} {:x 1967.2400003671646, :y 141037.2796394229} {:x 1967.470000371337, :y 141585.40826836228} {:x 1967.7000003755093, :y 142137.36779549718} {:x 1967.9300003796816, :y 142693.15822082758} {:x 1968.160000383854, :y 143252.77954432368} {:x 1968.3900003880262, :y 143816.2317659855} {:x 1968.6200003921986, :y 144383.514885813} {:x 1968.850000396371, :y 144954.628903836} {:x 1969.0800004005432, :y 145529.57382002473} {:x 1969.3100004047155, :y 146108.34963437915} {:x 1969.5400004088879, :y 146690.95634683967} {:x 1969.7700004130602, :y 147277.3939575553})} {:name \"12136f12-18ea-41d1-9916-c0e28a30af3e\", :values ({:x 1947, :y 107608} {:x 1948, :y 108632} {:x 1949, :y 109773} {:x 1950, :y 110929} {:x 1951, :y 112075} {:x 1952, :y 113270} {:x 1953, :y 115094} {:x 1954, :y 116219} {:x 1955, :y 117388} {:x 1956, :y 118734} {:x 1957, :y 120445} {:x 1958, :y 121950} {:x 1959, :y 123366} {:x 1960, :y 125368} {:x 1961, :y 127852} {:x 1962, :y 130081})}), :marks ({:type \"line\", :from {:data \"c4abb5ea-775c-4ebc-bd1e-72700cf3735e\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"#FF29D2\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}} {:type \"symbol\", :from {:data \"12136f12-18ea-41d1-9916-c0e28a30af3e\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :fill {:value \"steelblue\"}, :fillOpacity {:value 1}}, :update {:shape \"circle\", :size {:value 70}, :stroke {:value \"transparent\"}}, :hover {:size {:value 210}, :stroke {:value \"white\"}}}})}}"}
;; <=

;; **
;;; ## Armed forces
;; **

;; @@
(let [rows (:rows longley)
      d (map (juxt :x6 :x4) rows)]
  (plot/list-plot d :plot-size 600))
;; @@
;; =>
;;; {"type":"vega","content":{"width":600,"height":370.82818603515625,"padding":{"top":10,"left":55,"bottom":40,"right":10},"data":[{"name":"d74739cf-5b45-4774-bf95-b812dba8ce32","values":[{"x":1947,"y":1590},{"x":1948,"y":1456},{"x":1949,"y":1616},{"x":1950,"y":1650},{"x":1951,"y":3099},{"x":1952,"y":3594},{"x":1953,"y":3547},{"x":1954,"y":3350},{"x":1955,"y":3048},{"x":1956,"y":2857},{"x":1957,"y":2798},{"x":1958,"y":2637},{"x":1959,"y":2552},{"x":1960,"y":2514},{"x":1961,"y":2572},{"x":1962,"y":2827}]}],"marks":[{"type":"symbol","from":{"data":"d74739cf-5b45-4774-bf95-b812dba8ce32"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"fill":{"value":"steelblue"},"fillOpacity":{"value":1}},"update":{"shape":"circle","size":{"value":70},"stroke":{"value":"transparent"}},"hover":{"size":{"value":210},"stroke":{"value":"white"}}}}],"scales":[{"name":"x","type":"linear","range":"width","zero":false,"domain":{"data":"d74739cf-5b45-4774-bf95-b812dba8ce32","field":"data.x"}},{"name":"y","type":"linear","range":"height","nice":true,"zero":false,"domain":{"data":"d74739cf-5b45-4774-bf95-b812dba8ce32","field":"data.y"}}],"axes":[{"type":"x","scale":"x"},{"type":"y","scale":"y"}]},"value":"#gorilla_repl.vega.VegaView{:content {:width 600, :height 370.8282, :padding {:top 10, :left 55, :bottom 40, :right 10}, :data [{:name \"d74739cf-5b45-4774-bf95-b812dba8ce32\", :values ({:x 1947, :y 1590} {:x 1948, :y 1456} {:x 1949, :y 1616} {:x 1950, :y 1650} {:x 1951, :y 3099} {:x 1952, :y 3594} {:x 1953, :y 3547} {:x 1954, :y 3350} {:x 1955, :y 3048} {:x 1956, :y 2857} {:x 1957, :y 2798} {:x 1958, :y 2637} {:x 1959, :y 2552} {:x 1960, :y 2514} {:x 1961, :y 2572} {:x 1962, :y 2827})}], :marks [{:type \"symbol\", :from {:data \"d74739cf-5b45-4774-bf95-b812dba8ce32\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :fill {:value \"steelblue\"}, :fillOpacity {:value 1}}, :update {:shape \"circle\", :size {:value 70}, :stroke {:value \"transparent\"}}, :hover {:size {:value 210}, :stroke {:value \"white\"}}}}], :scales [{:name \"x\", :type \"linear\", :range \"width\", :zero false, :domain {:data \"d74739cf-5b45-4774-bf95-b812dba8ce32\", :field \"data.x\"}} {:name \"y\", :type \"linear\", :range \"height\", :nice true, :zero false, :domain {:data \"d74739cf-5b45-4774-bf95-b812dba8ce32\", :field \"data.y\"}}], :axes [{:type \"x\", :scale \"x\"} {:type \"y\", :scale \"y\"}]}}"}
;; <=

;; @@
(defn polynomial-forecast
  [coefs degree]
  (fn [x]
    (first
      (i/mmult (i/trans coefs)
               (for [i (range (inc degree))]
                 (i/pow x i))))))
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-var'>#&#x27;ch9.ws/polynomial-forecast</span>","value":"#'ch9.ws/polynomial-forecast"}
;; <=

;; @@
(let [x (s/sweep (i/$ :x6 longley))
      degree 11
      xs (reduce i/bind-columns
                 (for [i (range (inc degree))]
                   (i/pow x i)))
      model (s/linear-model (i/$ :x4 longley) xs
                            :intercept false)
      d (partition 2 (interleave (i/$ 1 xs) (map :x4 (:rows longley))))]
  (println "R^2" (:r-square model))
  (plot/compose
    (plot/plot #((polynomial-forecast (:coefs model)
                                      degree) %) [-7.6 7.6] 
               :plot-size 600)
    (plot/list-plot d)))
;; @@
;; ->
;;; R^2 0.9864923798403188
;;; 
;; <-
;; =>
;;; {"type":"vega","content":{"width":600,"height":370.82818603515625,"padding":{"top":10,"left":55,"bottom":40,"right":10},"scales":[{"name":"x","type":"linear","range":"width","zero":false,"domain":{"data":"413e3c4d-5001-41d5-8058-82bd93e5bd7c","field":"data.x"}},{"name":"y","type":"linear","range":"height","nice":true,"zero":false,"domain":{"data":"413e3c4d-5001-41d5-8058-82bd93e5bd7c","field":"data.y"}}],"axes":[{"type":"x","scale":"x"},{"type":"y","scale":"y"}],"data":[{"name":"413e3c4d-5001-41d5-8058-82bd93e5bd7c","values":[{"x":-7.6,"y":2294.470200646523},{"x":-7.4480000048875805,"y":1332.6137619002257},{"x":-7.296000009775161,"y":910.0518797291734},{"x":-7.144000014662742,"y":818.8325743171154},{"x":-6.992000019550323,"y":910.645158443891},{"x":-6.840000024437904,"y":1083.817139713865},{"x":-6.688000029325485,"y":1272.494225337883},{"x":-6.536000034213066,"y":1437.721883516686},{"x":-6.384000039100647,"y":1560.1741939195817},{"x":-6.2320000439882275,"y":1634.3011114861074},{"x":-6.080000048875808,"y":1663.6888564303263},{"x":-5.928000053763389,"y":1657.4500107398871},{"x":-5.77600005865097,"y":1627.4801276717517},{"x":-5.624000063538551,"y":1586.4363240016091},{"x":-5.472000068426132,"y":1546.3105015346946},{"x":-5.320000073313713,"y":1517.4856092896307},{"x":-5.168000078201294,"y":1508.1777836801393},{"x":-5.0160000830888745,"y":1524.180362010607},{"x":-4.864000087976455,"y":1568.8377239374129},{"x":-4.712000092864036,"y":1643.187743703794},{"x":-4.560000097751617,"y":1746.2213986099355},{"x":-4.408000102639198,"y":1875.2168402151692},{"x":-4.256000107526779,"y":2026.1130562738135},{"x":-4.10400011241436,"y":2193.8951936722938},{"x":-3.9520001173019406,"y":2372.9697341602064},{"x":-3.8000001221895214,"y":2557.513072153417},{"x":-3.6480001270771023,"y":2741.781692239674},{"x":-3.496000131964683,"y":2920.376136347233},{"x":-3.344000136852264,"y":3088.4543381606068},{"x":-3.192000141739845,"y":3241.8927348046204},{"x":-3.040000146627426,"y":3377.395890793569},{"x":-2.8880001515150067,"y":3492.5572326858505},{"x":-2.7360001564025875,"y":3585.874938930004},{"x":-2.5840001612901684,"y":3656.728100374375},{"x":-2.4320001661777493,"y":3705.3190033831675},{"x":-2.28000017106533,"y":3732.587828204054},{"x":-2.128000175952911,"y":3740.106237119781},{"x":-1.976000180840492,"y":3729.9562851453165},{"x":-1.8240001857280728,"y":3704.600853964891},{"x":-1.6720001906156536,"y":3666.7514190064303},{"x":-1.5200001955032345,"y":3619.238439795306},{"x":-1.3680002003908154,"y":3564.8890429907788},{"x":-1.2160002052783963,"y":3506.415971967474},{"x":-1.0640002101659771,"y":3446.3210308455114},{"x":-0.912000215053558,"y":3386.8154770862175},{"x":-0.7600002199411389,"y":3329.7590359499186},{"x":-0.6080002248287197,"y":3276.6184412569046},{"x":-0.4560002297163006,"y":3228.445667205927},{"x":-0.3040002346038815,"y":3185.8753208943917},{"x":-0.15200023949146235,"y":3149.1400282638047},{"x":-2.443790432238302E-7,"y":3118.102079280024},{"x":0.1519997507333759,"y":3092.2991112727445},{"x":0.30399974584579503,"y":3071.0012107288308},{"x":0.45599974095821416,"y":3053.2765098909294},{"x":0.6079997360706333,"y":3038.0621498920295},{"x":0.7599997311830524,"y":3024.237379698919},{"x":0.9119997262954715,"y":3010.695560887743},{"x":1.0639997214078907,"y":2996.411951482975},{"x":1.2159997165203098,"y":2980.504345211401},{"x":1.367999711632729,"y":2962.283941214145},{"x":1.519999706745148,"y":2941.2942073859804},{"x":1.6719997018575672,"y":2917.3359701403874},{"x":1.8239996969699863,"y":2890.477504803992},{"x":1.9759996920824054,"y":2861.0490025024487},{"x":2.1279996871948246,"y":2829.621437993908},{"x":2.2799996823072437,"y":2796.970543322397},{"x":2.431999677419663,"y":2764.0272874933376},{"x":2.583999672532082,"y":2731.816953912893},{"x":2.735999667644501,"y":2701.389574582503},{"x":2.88799966275692,"y":2673.7451007052173},{"x":3.0399996578693393,"y":2649.7572393508835},{"x":3.1919996529817585,"y":2630.1003392577127},{"x":3.3439996480941776,"y":2615.1840380370368},{"x":3.4959996432065967,"y":2605.1005585201924},{"x":3.647999638319016,"y":2599.5895324696544},{"x":3.799999633431435,"y":2598.0250023037675},{"x":3.951999628543854,"y":2599.4287709935174},{"x":4.103999623656273,"y":2602.5135002227307},{"x":4.255999618768692,"y":2605.757858806918},{"x":4.4079996138811115,"y":2607.5145569922693},{"x":4.559999608993531,"y":2606.1502255609407},{"x":4.71199960410595,"y":2600.2137678127565},{"x":4.863999599218369,"y":2588.6269818420687},{"x":5.015999594330788,"y":2570.887872651705},{"x":5.167999589443207,"y":2547.2730993183845},{"x":5.319999584555626,"y":2519.0213806250786},{"x":5.471999579668045,"y":2488.4743604892847},{"x":5.6239995747804645,"y":2459.1453575301966},{"x":5.775999569892884,"y":2435.6795348266915},{"x":5.927999565005303,"y":2423.6612681176284},{"x":6.079999560117722,"y":2429.215803391133},{"x":6.231999555230141,"y":2458.3426162044343},{"x":6.38399955034256,"y":2515.90715158471},{"x":6.535999545454979,"y":2604.2057695989424},{"x":6.687999540567398,"y":2721.00568046877},{"x":6.8399995356798176,"y":2856.94735546803},{"x":6.991999530792237,"y":2992.181275011768},{"x":7.143999525904656,"y":3092.093850752819},{"x":7.295999521017075,"y":3101.9588597909897},{"x":7.447999516129494,"y":2940.3306801154104},{"x":7.599999511241913,"y":2490.9739391820913}]},{"name":"ccc06695-944c-4355-8f74-55bdf81e85ff","values":[{"x":-7.5,"y":1590},{"x":-6.5,"y":1456},{"x":-5.5,"y":1616},{"x":-4.5,"y":1650},{"x":-3.5,"y":3099},{"x":-2.5,"y":3594},{"x":-1.5,"y":3547},{"x":-0.5,"y":3350},{"x":0.5,"y":3048},{"x":1.5,"y":2857},{"x":2.5,"y":2798},{"x":3.5,"y":2637},{"x":4.5,"y":2552},{"x":5.5,"y":2514},{"x":6.5,"y":2572},{"x":7.5,"y":2827}]}],"marks":[{"type":"line","from":{"data":"413e3c4d-5001-41d5-8058-82bd93e5bd7c"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"#FF29D2"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}},{"type":"symbol","from":{"data":"ccc06695-944c-4355-8f74-55bdf81e85ff"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"fill":{"value":"steelblue"},"fillOpacity":{"value":1}},"update":{"shape":"circle","size":{"value":70},"stroke":{"value":"transparent"}},"hover":{"size":{"value":210},"stroke":{"value":"white"}}}}]},"value":"#gorilla_repl.vega.VegaView{:content {:width 600, :height 370.8282, :padding {:top 10, :left 55, :bottom 40, :right 10}, :scales [{:name \"x\", :type \"linear\", :range \"width\", :zero false, :domain {:data \"413e3c4d-5001-41d5-8058-82bd93e5bd7c\", :field \"data.x\"}} {:name \"y\", :type \"linear\", :range \"height\", :nice true, :zero false, :domain {:data \"413e3c4d-5001-41d5-8058-82bd93e5bd7c\", :field \"data.y\"}}], :axes [{:type \"x\", :scale \"x\"} {:type \"y\", :scale \"y\"}], :data ({:name \"413e3c4d-5001-41d5-8058-82bd93e5bd7c\", :values ({:x -7.6, :y 2294.470200646523} {:x -7.4480000048875805, :y 1332.6137619002257} {:x -7.296000009775161, :y 910.0518797291734} {:x -7.144000014662742, :y 818.8325743171154} {:x -6.992000019550323, :y 910.645158443891} {:x -6.840000024437904, :y 1083.817139713865} {:x -6.688000029325485, :y 1272.494225337883} {:x -6.536000034213066, :y 1437.721883516686} {:x -6.384000039100647, :y 1560.1741939195817} {:x -6.2320000439882275, :y 1634.3011114861074} {:x -6.080000048875808, :y 1663.6888564303263} {:x -5.928000053763389, :y 1657.4500107398871} {:x -5.77600005865097, :y 1627.4801276717517} {:x -5.624000063538551, :y 1586.4363240016091} {:x -5.472000068426132, :y 1546.3105015346946} {:x -5.320000073313713, :y 1517.4856092896307} {:x -5.168000078201294, :y 1508.1777836801393} {:x -5.0160000830888745, :y 1524.180362010607} {:x -4.864000087976455, :y 1568.8377239374129} {:x -4.712000092864036, :y 1643.187743703794} {:x -4.560000097751617, :y 1746.2213986099355} {:x -4.408000102639198, :y 1875.2168402151692} {:x -4.256000107526779, :y 2026.1130562738135} {:x -4.10400011241436, :y 2193.8951936722938} {:x -3.9520001173019406, :y 2372.9697341602064} {:x -3.8000001221895214, :y 2557.513072153417} {:x -3.6480001270771023, :y 2741.781692239674} {:x -3.496000131964683, :y 2920.376136347233} {:x -3.344000136852264, :y 3088.4543381606068} {:x -3.192000141739845, :y 3241.8927348046204} {:x -3.040000146627426, :y 3377.395890793569} {:x -2.8880001515150067, :y 3492.5572326858505} {:x -2.7360001564025875, :y 3585.874938930004} {:x -2.5840001612901684, :y 3656.728100374375} {:x -2.4320001661777493, :y 3705.3190033831675} {:x -2.28000017106533, :y 3732.587828204054} {:x -2.128000175952911, :y 3740.106237119781} {:x -1.976000180840492, :y 3729.9562851453165} {:x -1.8240001857280728, :y 3704.600853964891} {:x -1.6720001906156536, :y 3666.7514190064303} {:x -1.5200001955032345, :y 3619.238439795306} {:x -1.3680002003908154, :y 3564.8890429907788} {:x -1.2160002052783963, :y 3506.415971967474} {:x -1.0640002101659771, :y 3446.3210308455114} {:x -0.912000215053558, :y 3386.8154770862175} {:x -0.7600002199411389, :y 3329.7590359499186} {:x -0.6080002248287197, :y 3276.6184412569046} {:x -0.4560002297163006, :y 3228.445667205927} {:x -0.3040002346038815, :y 3185.8753208943917} {:x -0.15200023949146235, :y 3149.1400282638047} {:x -2.443790432238302E-7, :y 3118.102079280024} {:x 0.1519997507333759, :y 3092.2991112727445} {:x 0.30399974584579503, :y 3071.0012107288308} {:x 0.45599974095821416, :y 3053.2765098909294} {:x 0.6079997360706333, :y 3038.0621498920295} {:x 0.7599997311830524, :y 3024.237379698919} {:x 0.9119997262954715, :y 3010.695560887743} {:x 1.0639997214078907, :y 2996.411951482975} {:x 1.2159997165203098, :y 2980.504345211401} {:x 1.367999711632729, :y 2962.283941214145} {:x 1.519999706745148, :y 2941.2942073859804} {:x 1.6719997018575672, :y 2917.3359701403874} {:x 1.8239996969699863, :y 2890.477504803992} {:x 1.9759996920824054, :y 2861.0490025024487} {:x 2.1279996871948246, :y 2829.621437993908} {:x 2.2799996823072437, :y 2796.970543322397} {:x 2.431999677419663, :y 2764.0272874933376} {:x 2.583999672532082, :y 2731.816953912893} {:x 2.735999667644501, :y 2701.389574582503} {:x 2.88799966275692, :y 2673.7451007052173} {:x 3.0399996578693393, :y 2649.7572393508835} {:x 3.1919996529817585, :y 2630.1003392577127} {:x 3.3439996480941776, :y 2615.1840380370368} {:x 3.4959996432065967, :y 2605.1005585201924} {:x 3.647999638319016, :y 2599.5895324696544} {:x 3.799999633431435, :y 2598.0250023037675} {:x 3.951999628543854, :y 2599.4287709935174} {:x 4.103999623656273, :y 2602.5135002227307} {:x 4.255999618768692, :y 2605.757858806918} {:x 4.4079996138811115, :y 2607.5145569922693} {:x 4.559999608993531, :y 2606.1502255609407} {:x 4.71199960410595, :y 2600.2137678127565} {:x 4.863999599218369, :y 2588.6269818420687} {:x 5.015999594330788, :y 2570.887872651705} {:x 5.167999589443207, :y 2547.2730993183845} {:x 5.319999584555626, :y 2519.0213806250786} {:x 5.471999579668045, :y 2488.4743604892847} {:x 5.6239995747804645, :y 2459.1453575301966} {:x 5.775999569892884, :y 2435.6795348266915} {:x 5.927999565005303, :y 2423.6612681176284} {:x 6.079999560117722, :y 2429.215803391133} {:x 6.231999555230141, :y 2458.3426162044343} {:x 6.38399955034256, :y 2515.90715158471} {:x 6.535999545454979, :y 2604.2057695989424} {:x 6.687999540567398, :y 2721.00568046877} {:x 6.8399995356798176, :y 2856.94735546803} {:x 6.991999530792237, :y 2992.181275011768} {:x 7.143999525904656, :y 3092.093850752819} {:x 7.295999521017075, :y 3101.9588597909897} {:x 7.447999516129494, :y 2940.3306801154104} {:x 7.599999511241913, :y 2490.9739391820913})} {:name \"ccc06695-944c-4355-8f74-55bdf81e85ff\", :values ({:x -7.5, :y 1590} {:x -6.5, :y 1456} {:x -5.5, :y 1616} {:x -4.5, :y 1650} {:x -3.5, :y 3099} {:x -2.5, :y 3594} {:x -1.5, :y 3547} {:x -0.5, :y 3350} {:x 0.5, :y 3048} {:x 1.5, :y 2857} {:x 2.5, :y 2798} {:x 3.5, :y 2637} {:x 4.5, :y 2552} {:x 5.5, :y 2514} {:x 6.5, :y 2572} {:x 7.5, :y 2827})}), :marks ({:type \"line\", :from {:data \"413e3c4d-5001-41d5-8058-82bd93e5bd7c\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"#FF29D2\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}} {:type \"symbol\", :from {:data \"ccc06695-944c-4355-8f74-55bdf81e85ff\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :fill {:value \"steelblue\"}, :fillOpacity {:value 1}}, :update {:shape \"circle\", :size {:value 70}, :stroke {:value \"transparent\"}}, :hover {:size {:value 210}, :stroke {:value \"white\"}}}})}}"}
;; <=

;; **
;;; ## Airline data
;; **

;; @@
(def airline (d/get-dataset :airline-passengers))
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-var'>#&#x27;ch9.ws/airline</span>","value":"#'ch9.ws/airline"}
;; <=

;; @@
(def time-format
  (tf/formatter "MMM YYYY"))

(defn to-time
  [month year]
  (tf/parse time-format (str month " " year)))
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-var'>#&#x27;ch9.ws/to-time</span>","value":"#'ch9.ws/to-time"}
;; <=

;; @@
(defn airline-passengers
  []
  (->> airline
       (i/add-derived-column :time [:month :year] to-time)
       (i/$order :time :asc)
       (i/$ :passengers)))
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-var'>#&#x27;ch9.ws/airline-passengers</span>","value":"#'ch9.ws/airline-passengers"}
;; <=

;; @@
(let [passengers (airline-passengers)
      x (range (count passengers))
      d (partition 2 (interleave x passengers))]
  (plot/list-plot
    d :joined true :plot-size 600))
;; @@
;; =>
;;; {"type":"vega","content":{"width":600,"height":370.82818603515625,"padding":{"top":10,"left":55,"bottom":40,"right":10},"data":[{"name":"27225200-92f3-4d38-b881-a37eacc4217a","values":[{"x":0,"y":112},{"x":1,"y":118},{"x":2,"y":132},{"x":3,"y":129},{"x":4,"y":121},{"x":5,"y":135},{"x":6,"y":148},{"x":7,"y":148},{"x":8,"y":136},{"x":9,"y":119},{"x":10,"y":104},{"x":11,"y":118},{"x":12,"y":115},{"x":13,"y":126},{"x":14,"y":141},{"x":15,"y":135},{"x":16,"y":125},{"x":17,"y":149},{"x":18,"y":170},{"x":19,"y":170},{"x":20,"y":158},{"x":21,"y":133},{"x":22,"y":114},{"x":23,"y":140},{"x":24,"y":145},{"x":25,"y":150},{"x":26,"y":178},{"x":27,"y":163},{"x":28,"y":172},{"x":29,"y":178},{"x":30,"y":199},{"x":31,"y":199},{"x":32,"y":184},{"x":33,"y":162},{"x":34,"y":146},{"x":35,"y":166},{"x":36,"y":171},{"x":37,"y":180},{"x":38,"y":193},{"x":39,"y":181},{"x":40,"y":183},{"x":41,"y":218},{"x":42,"y":230},{"x":43,"y":242},{"x":44,"y":209},{"x":45,"y":191},{"x":46,"y":172},{"x":47,"y":194},{"x":48,"y":196},{"x":49,"y":196},{"x":50,"y":236},{"x":51,"y":235},{"x":52,"y":229},{"x":53,"y":243},{"x":54,"y":264},{"x":55,"y":272},{"x":56,"y":237},{"x":57,"y":211},{"x":58,"y":180},{"x":59,"y":201},{"x":60,"y":204},{"x":61,"y":188},{"x":62,"y":235},{"x":63,"y":227},{"x":64,"y":234},{"x":65,"y":264},{"x":66,"y":302},{"x":67,"y":293},{"x":68,"y":259},{"x":69,"y":229},{"x":70,"y":203},{"x":71,"y":229},{"x":72,"y":242},{"x":73,"y":233},{"x":74,"y":267},{"x":75,"y":269},{"x":76,"y":270},{"x":77,"y":315},{"x":78,"y":364},{"x":79,"y":347},{"x":80,"y":312},{"x":81,"y":274},{"x":82,"y":237},{"x":83,"y":278},{"x":84,"y":284},{"x":85,"y":277},{"x":86,"y":317},{"x":87,"y":313},{"x":88,"y":318},{"x":89,"y":374},{"x":90,"y":413},{"x":91,"y":405},{"x":92,"y":355},{"x":93,"y":306},{"x":94,"y":271},{"x":95,"y":306},{"x":96,"y":315},{"x":97,"y":301},{"x":98,"y":356},{"x":99,"y":348},{"x":100,"y":355},{"x":101,"y":422},{"x":102,"y":465},{"x":103,"y":467},{"x":104,"y":404},{"x":105,"y":347},{"x":106,"y":305},{"x":107,"y":336},{"x":108,"y":340},{"x":109,"y":318},{"x":110,"y":362},{"x":111,"y":348},{"x":112,"y":363},{"x":113,"y":435},{"x":114,"y":491},{"x":115,"y":505},{"x":116,"y":404},{"x":117,"y":359},{"x":118,"y":310},{"x":119,"y":337},{"x":120,"y":360},{"x":121,"y":342},{"x":122,"y":406},{"x":123,"y":396},{"x":124,"y":420},{"x":125,"y":472},{"x":126,"y":548},{"x":127,"y":559},{"x":128,"y":463},{"x":129,"y":407},{"x":130,"y":362},{"x":131,"y":405},{"x":132,"y":417},{"x":133,"y":391},{"x":134,"y":419},{"x":135,"y":461},{"x":136,"y":472},{"x":137,"y":535},{"x":138,"y":622},{"x":139,"y":606},{"x":140,"y":508},{"x":141,"y":461},{"x":142,"y":390},{"x":143,"y":432}]}],"marks":[{"type":"line","from":{"data":"27225200-92f3-4d38-b881-a37eacc4217a"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"#FF29D2"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}}],"scales":[{"name":"x","type":"linear","range":"width","zero":false,"domain":{"data":"27225200-92f3-4d38-b881-a37eacc4217a","field":"data.x"}},{"name":"y","type":"linear","range":"height","nice":true,"zero":false,"domain":{"data":"27225200-92f3-4d38-b881-a37eacc4217a","field":"data.y"}}],"axes":[{"type":"x","scale":"x"},{"type":"y","scale":"y"}]},"value":"#gorilla_repl.vega.VegaView{:content {:width 600, :height 370.8282, :padding {:top 10, :left 55, :bottom 40, :right 10}, :data [{:name \"27225200-92f3-4d38-b881-a37eacc4217a\", :values ({:x 0, :y 112} {:x 1, :y 118} {:x 2, :y 132} {:x 3, :y 129} {:x 4, :y 121} {:x 5, :y 135} {:x 6, :y 148} {:x 7, :y 148} {:x 8, :y 136} {:x 9, :y 119} {:x 10, :y 104} {:x 11, :y 118} {:x 12, :y 115} {:x 13, :y 126} {:x 14, :y 141} {:x 15, :y 135} {:x 16, :y 125} {:x 17, :y 149} {:x 18, :y 170} {:x 19, :y 170} {:x 20, :y 158} {:x 21, :y 133} {:x 22, :y 114} {:x 23, :y 140} {:x 24, :y 145} {:x 25, :y 150} {:x 26, :y 178} {:x 27, :y 163} {:x 28, :y 172} {:x 29, :y 178} {:x 30, :y 199} {:x 31, :y 199} {:x 32, :y 184} {:x 33, :y 162} {:x 34, :y 146} {:x 35, :y 166} {:x 36, :y 171} {:x 37, :y 180} {:x 38, :y 193} {:x 39, :y 181} {:x 40, :y 183} {:x 41, :y 218} {:x 42, :y 230} {:x 43, :y 242} {:x 44, :y 209} {:x 45, :y 191} {:x 46, :y 172} {:x 47, :y 194} {:x 48, :y 196} {:x 49, :y 196} {:x 50, :y 236} {:x 51, :y 235} {:x 52, :y 229} {:x 53, :y 243} {:x 54, :y 264} {:x 55, :y 272} {:x 56, :y 237} {:x 57, :y 211} {:x 58, :y 180} {:x 59, :y 201} {:x 60, :y 204} {:x 61, :y 188} {:x 62, :y 235} {:x 63, :y 227} {:x 64, :y 234} {:x 65, :y 264} {:x 66, :y 302} {:x 67, :y 293} {:x 68, :y 259} {:x 69, :y 229} {:x 70, :y 203} {:x 71, :y 229} {:x 72, :y 242} {:x 73, :y 233} {:x 74, :y 267} {:x 75, :y 269} {:x 76, :y 270} {:x 77, :y 315} {:x 78, :y 364} {:x 79, :y 347} {:x 80, :y 312} {:x 81, :y 274} {:x 82, :y 237} {:x 83, :y 278} {:x 84, :y 284} {:x 85, :y 277} {:x 86, :y 317} {:x 87, :y 313} {:x 88, :y 318} {:x 89, :y 374} {:x 90, :y 413} {:x 91, :y 405} {:x 92, :y 355} {:x 93, :y 306} {:x 94, :y 271} {:x 95, :y 306} {:x 96, :y 315} {:x 97, :y 301} {:x 98, :y 356} {:x 99, :y 348} {:x 100, :y 355} {:x 101, :y 422} {:x 102, :y 465} {:x 103, :y 467} {:x 104, :y 404} {:x 105, :y 347} {:x 106, :y 305} {:x 107, :y 336} {:x 108, :y 340} {:x 109, :y 318} {:x 110, :y 362} {:x 111, :y 348} {:x 112, :y 363} {:x 113, :y 435} {:x 114, :y 491} {:x 115, :y 505} {:x 116, :y 404} {:x 117, :y 359} {:x 118, :y 310} {:x 119, :y 337} {:x 120, :y 360} {:x 121, :y 342} {:x 122, :y 406} {:x 123, :y 396} {:x 124, :y 420} {:x 125, :y 472} {:x 126, :y 548} {:x 127, :y 559} {:x 128, :y 463} {:x 129, :y 407} {:x 130, :y 362} {:x 131, :y 405} {:x 132, :y 417} {:x 133, :y 391} {:x 134, :y 419} {:x 135, :y 461} {:x 136, :y 472} {:x 137, :y 535} {:x 138, :y 622} {:x 139, :y 606} {:x 140, :y 508} {:x 141, :y 461} {:x 142, :y 390} {:x 143, :y 432})}], :marks [{:type \"line\", :from {:data \"27225200-92f3-4d38-b881-a37eacc4217a\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"#FF29D2\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}}], :scales [{:name \"x\", :type \"linear\", :range \"width\", :zero false, :domain {:data \"27225200-92f3-4d38-b881-a37eacc4217a\", :field \"data.x\"}} {:name \"y\", :type \"linear\", :range \"height\", :nice true, :zero false, :domain {:data \"27225200-92f3-4d38-b881-a37eacc4217a\", :field \"data.y\"}}], :axes [{:type \"x\", :scale \"x\"} {:type \"y\", :scale \"y\"}]}}"}
;; <=

;; @@
(defn ts-plot
  [data]
  (let [x (range (count data))
        d (partition 2 (interleave x data))]
    (plot/list-plot
      d :joined true :plot-size 600)))
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-var'>#&#x27;ch9.ws/ts-plot</span>","value":"#'ch9.ws/ts-plot"}
;; <=

;; **
;;; ## Stationarity
;;; 
;;; A stationary time series has constant statistical properties in time. To remove both the increasing variance and the growth curve we can take the log of passenger numbers
;; **

;; @@
(-> (airline-passengers)
    (i/log)
    (ts-plot))
;; @@
;; =>
;;; {"type":"vega","content":{"width":600,"height":370.82818603515625,"padding":{"top":10,"left":55,"bottom":40,"right":10},"data":[{"name":"6a87d663-2b3b-4496-b62b-ff96099c9464","values":[{"x":0,"y":4.718498871295094},{"x":1,"y":4.770684624465665},{"x":2,"y":4.882801922586371},{"x":3,"y":4.859812404361672},{"x":4,"y":4.795790545596741},{"x":5,"y":4.90527477843843},{"x":6,"y":4.997212273764115},{"x":7,"y":4.997212273764115},{"x":8,"y":4.912654885736052},{"x":9,"y":4.77912349311153},{"x":10,"y":4.6443908991413725},{"x":11,"y":4.770684624465665},{"x":12,"y":4.74493212836325},{"x":13,"y":4.836281906951478},{"x":14,"y":4.948759890378168},{"x":15,"y":4.90527477843843},{"x":16,"y":4.8283137373023015},{"x":17,"y":5.003946305945459},{"x":18,"y":5.135798437050262},{"x":19,"y":5.135798437050262},{"x":20,"y":5.062595033026967},{"x":21,"y":4.890349128221754},{"x":22,"y":4.736198448394496},{"x":23,"y":4.941642422609304},{"x":24,"y":4.976733742420574},{"x":25,"y":5.0106352940962555},{"x":26,"y":5.181783550292085},{"x":27,"y":5.093750200806762},{"x":28,"y":5.147494476813453},{"x":29,"y":5.181783550292085},{"x":30,"y":5.293304824724492},{"x":31,"y":5.293304824724492},{"x":32,"y":5.214935757608986},{"x":33,"y":5.087596335232384},{"x":34,"y":4.983606621708336},{"x":35,"y":5.111987788356544},{"x":36,"y":5.14166355650266},{"x":37,"y":5.19295685089021},{"x":38,"y":5.262690188904886},{"x":39,"y":5.198497031265826},{"x":40,"y":5.209486152841421},{"x":41,"y":5.384495062789089},{"x":42,"y":5.438079308923196},{"x":43,"y":5.488937726156687},{"x":44,"y":5.342334251964811},{"x":45,"y":5.25227342804663},{"x":46,"y":5.147494476813453},{"x":47,"y":5.267858159063328},{"x":48,"y":5.278114659230517},{"x":49,"y":5.278114659230517},{"x":50,"y":5.4638318050256105},{"x":51,"y":5.459585514144159},{"x":52,"y":5.43372200355424},{"x":53,"y":5.493061443340548},{"x":54,"y":5.575949103146316},{"x":55,"y":5.605802066295998},{"x":56,"y":5.4680601411351315},{"x":57,"y":5.351858133476067},{"x":58,"y":5.19295685089021},{"x":59,"y":5.303304908059076},{"x":60,"y":5.318119993844216},{"x":61,"y":5.236441962829949},{"x":62,"y":5.459585514144159},{"x":63,"y":5.424950017481403},{"x":64,"y":5.455321115357702},{"x":65,"y":5.575949103146316},{"x":66,"y":5.71042701737487},{"x":67,"y":5.680172609017068},{"x":68,"y":5.556828061699537},{"x":69,"y":5.43372200355424},{"x":70,"y":5.313205979041787},{"x":71,"y":5.43372200355424},{"x":72,"y":5.488937726156687},{"x":73,"y":5.4510384535657},{"x":74,"y":5.58724865840025},{"x":75,"y":5.594711379601839},{"x":76,"y":5.598421958998375},{"x":77,"y":5.752572638825633},{"x":78,"y":5.8971538676367405},{"x":79,"y":5.849324779946859},{"x":80,"y":5.7430031878094825},{"x":81,"y":5.6131281063880705},{"x":82,"y":5.4680601411351315},{"x":83,"y":5.627621113690637},{"x":84,"y":5.648974238161206},{"x":85,"y":5.6240175061873385},{"x":86,"y":5.75890177387728},{"x":87,"y":5.746203190540153},{"x":88,"y":5.762051382780177},{"x":89,"y":5.924255797414532},{"x":90,"y":6.023447592961033},{"x":91,"y":6.003887067106539},{"x":92,"y":5.872117789475416},{"x":93,"y":5.723585101952381},{"x":94,"y":5.602118820879701},{"x":95,"y":5.723585101952381},{"x":96,"y":5.752572638825633},{"x":97,"y":5.707110264748875},{"x":98,"y":5.87493073085203},{"x":99,"y":5.8522024797744745},{"x":100,"y":5.872117789475416},{"x":101,"y":6.045005314036012},{"x":102,"y":6.142037405587356},{"x":103,"y":6.1463292576688975},{"x":104,"y":6.0014148779611505},{"x":105,"y":5.849324779946859},{"x":106,"y":5.720311776607412},{"x":107,"y":5.817111159963204},{"x":108,"y":5.8289456176102075},{"x":109,"y":5.762051382780177},{"x":110,"y":5.8916442118257715},{"x":111,"y":5.8522024797744745},{"x":112,"y":5.8944028342648505},{"x":113,"y":6.075346031088684},{"x":114,"y":6.19644412779452},{"x":115,"y":6.22455842927536},{"x":116,"y":6.0014148779611505},{"x":117,"y":5.883322388488279},{"x":118,"y":5.736572297479192},{"x":119,"y":5.820082930352362},{"x":120,"y":5.886104031450156},{"x":121,"y":5.834810737062605},{"x":122,"y":6.0063531596017325},{"x":123,"y":5.981414211254481},{"x":124,"y":6.040254711277414},{"x":125,"y":6.156978985585555},{"x":126,"y":6.306275286948016},{"x":127,"y":6.326149473155099},{"x":128,"y":6.137727054086234},{"x":129,"y":6.008813185442595},{"x":130,"y":5.8916442118257715},{"x":131,"y":6.003887067106539},{"x":132,"y":6.0330862217988015},{"x":133,"y":5.968707559985366},{"x":134,"y":6.037870919922137},{"x":135,"y":6.133398042996649},{"x":136,"y":6.156978985585555},{"x":137,"y":6.282266746896006},{"x":138,"y":6.432940092739179},{"x":139,"y":6.406879986069314},{"x":140,"y":6.230481447578482},{"x":141,"y":6.133398042996649},{"x":142,"y":5.966146739123692},{"x":143,"y":6.068425588244111}]}],"marks":[{"type":"line","from":{"data":"6a87d663-2b3b-4496-b62b-ff96099c9464"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"#FF29D2"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}}],"scales":[{"name":"x","type":"linear","range":"width","zero":false,"domain":{"data":"6a87d663-2b3b-4496-b62b-ff96099c9464","field":"data.x"}},{"name":"y","type":"linear","range":"height","nice":true,"zero":false,"domain":{"data":"6a87d663-2b3b-4496-b62b-ff96099c9464","field":"data.y"}}],"axes":[{"type":"x","scale":"x"},{"type":"y","scale":"y"}]},"value":"#gorilla_repl.vega.VegaView{:content {:width 600, :height 370.8282, :padding {:top 10, :left 55, :bottom 40, :right 10}, :data [{:name \"6a87d663-2b3b-4496-b62b-ff96099c9464\", :values ({:x 0, :y 4.718498871295094} {:x 1, :y 4.770684624465665} {:x 2, :y 4.882801922586371} {:x 3, :y 4.859812404361672} {:x 4, :y 4.795790545596741} {:x 5, :y 4.90527477843843} {:x 6, :y 4.997212273764115} {:x 7, :y 4.997212273764115} {:x 8, :y 4.912654885736052} {:x 9, :y 4.77912349311153} {:x 10, :y 4.6443908991413725} {:x 11, :y 4.770684624465665} {:x 12, :y 4.74493212836325} {:x 13, :y 4.836281906951478} {:x 14, :y 4.948759890378168} {:x 15, :y 4.90527477843843} {:x 16, :y 4.8283137373023015} {:x 17, :y 5.003946305945459} {:x 18, :y 5.135798437050262} {:x 19, :y 5.135798437050262} {:x 20, :y 5.062595033026967} {:x 21, :y 4.890349128221754} {:x 22, :y 4.736198448394496} {:x 23, :y 4.941642422609304} {:x 24, :y 4.976733742420574} {:x 25, :y 5.0106352940962555} {:x 26, :y 5.181783550292085} {:x 27, :y 5.093750200806762} {:x 28, :y 5.147494476813453} {:x 29, :y 5.181783550292085} {:x 30, :y 5.293304824724492} {:x 31, :y 5.293304824724492} {:x 32, :y 5.214935757608986} {:x 33, :y 5.087596335232384} {:x 34, :y 4.983606621708336} {:x 35, :y 5.111987788356544} {:x 36, :y 5.14166355650266} {:x 37, :y 5.19295685089021} {:x 38, :y 5.262690188904886} {:x 39, :y 5.198497031265826} {:x 40, :y 5.209486152841421} {:x 41, :y 5.384495062789089} {:x 42, :y 5.438079308923196} {:x 43, :y 5.488937726156687} {:x 44, :y 5.342334251964811} {:x 45, :y 5.25227342804663} {:x 46, :y 5.147494476813453} {:x 47, :y 5.267858159063328} {:x 48, :y 5.278114659230517} {:x 49, :y 5.278114659230517} {:x 50, :y 5.4638318050256105} {:x 51, :y 5.459585514144159} {:x 52, :y 5.43372200355424} {:x 53, :y 5.493061443340548} {:x 54, :y 5.575949103146316} {:x 55, :y 5.605802066295998} {:x 56, :y 5.4680601411351315} {:x 57, :y 5.351858133476067} {:x 58, :y 5.19295685089021} {:x 59, :y 5.303304908059076} {:x 60, :y 5.318119993844216} {:x 61, :y 5.236441962829949} {:x 62, :y 5.459585514144159} {:x 63, :y 5.424950017481403} {:x 64, :y 5.455321115357702} {:x 65, :y 5.575949103146316} {:x 66, :y 5.71042701737487} {:x 67, :y 5.680172609017068} {:x 68, :y 5.556828061699537} {:x 69, :y 5.43372200355424} {:x 70, :y 5.313205979041787} {:x 71, :y 5.43372200355424} {:x 72, :y 5.488937726156687} {:x 73, :y 5.4510384535657} {:x 74, :y 5.58724865840025} {:x 75, :y 5.594711379601839} {:x 76, :y 5.598421958998375} {:x 77, :y 5.752572638825633} {:x 78, :y 5.8971538676367405} {:x 79, :y 5.849324779946859} {:x 80, :y 5.7430031878094825} {:x 81, :y 5.6131281063880705} {:x 82, :y 5.4680601411351315} {:x 83, :y 5.627621113690637} {:x 84, :y 5.648974238161206} {:x 85, :y 5.6240175061873385} {:x 86, :y 5.75890177387728} {:x 87, :y 5.746203190540153} {:x 88, :y 5.762051382780177} {:x 89, :y 5.924255797414532} {:x 90, :y 6.023447592961033} {:x 91, :y 6.003887067106539} {:x 92, :y 5.872117789475416} {:x 93, :y 5.723585101952381} {:x 94, :y 5.602118820879701} {:x 95, :y 5.723585101952381} {:x 96, :y 5.752572638825633} {:x 97, :y 5.707110264748875} {:x 98, :y 5.87493073085203} {:x 99, :y 5.8522024797744745} {:x 100, :y 5.872117789475416} {:x 101, :y 6.045005314036012} {:x 102, :y 6.142037405587356} {:x 103, :y 6.1463292576688975} {:x 104, :y 6.0014148779611505} {:x 105, :y 5.849324779946859} {:x 106, :y 5.720311776607412} {:x 107, :y 5.817111159963204} {:x 108, :y 5.8289456176102075} {:x 109, :y 5.762051382780177} {:x 110, :y 5.8916442118257715} {:x 111, :y 5.8522024797744745} {:x 112, :y 5.8944028342648505} {:x 113, :y 6.075346031088684} {:x 114, :y 6.19644412779452} {:x 115, :y 6.22455842927536} {:x 116, :y 6.0014148779611505} {:x 117, :y 5.883322388488279} {:x 118, :y 5.736572297479192} {:x 119, :y 5.820082930352362} {:x 120, :y 5.886104031450156} {:x 121, :y 5.834810737062605} {:x 122, :y 6.0063531596017325} {:x 123, :y 5.981414211254481} {:x 124, :y 6.040254711277414} {:x 125, :y 6.156978985585555} {:x 126, :y 6.306275286948016} {:x 127, :y 6.326149473155099} {:x 128, :y 6.137727054086234} {:x 129, :y 6.008813185442595} {:x 130, :y 5.8916442118257715} {:x 131, :y 6.003887067106539} {:x 132, :y 6.0330862217988015} {:x 133, :y 5.968707559985366} {:x 134, :y 6.037870919922137} {:x 135, :y 6.133398042996649} {:x 136, :y 6.156978985585555} {:x 137, :y 6.282266746896006} {:x 138, :y 6.432940092739179} {:x 139, :y 6.406879986069314} {:x 140, :y 6.230481447578482} {:x 141, :y 6.133398042996649} {:x 142, :y 5.966146739123692} {:x 143, :y 6.068425588244111})}], :marks [{:type \"line\", :from {:data \"6a87d663-2b3b-4496-b62b-ff96099c9464\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"#FF29D2\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}}], :scales [{:name \"x\", :type \"linear\", :range \"width\", :zero false, :domain {:data \"6a87d663-2b3b-4496-b62b-ff96099c9464\", :field \"data.x\"}} {:name \"y\", :type \"linear\", :range \"height\", :nice true, :zero false, :domain {:data \"6a87d663-2b3b-4496-b62b-ff96099c9464\", :field \"data.y\"}}], :axes [{:type \"x\", :scale \"x\"} {:type \"y\", :scale \"y\"}]}}"}
;; <=

;; **
;;; ## De-trending
;; **

;; @@
(let [data (i/log (airline-passengers))
      xs (range (count data))
      model (s/linear-model data xs)]
  (plot/list-plot
    (partition 2 (interleave xs (:residuals model)))
    :joined true
    :plot-size 600))
;; @@
;; =>
;;; {"type":"vega","content":{"width":600,"height":370.82818603515625,"padding":{"top":10,"left":55,"bottom":40,"right":10},"data":[{"name":"d858dce1-6192-46c4-bbba-46321a47088d","values":[{"x":0,"y":-0.1052177927055622},{"x":1,"y":-0.06308042127668667},{"x":2,"y":0.038988495102323384},{"x":3,"y":0.005950595135929326},{"x":4,"y":-0.06811964537069581},{"x":5,"y":0.03131620572929705},{"x":6,"y":0.1132053193132867},{"x":7,"y":0.10315693757159128},{"x":8,"y":0.008551167801833515},{"x":9,"y":-0.13502860656438465},{"x":10,"y":-0.2798095822762363},{"x":11,"y":-0.16356423869363912},{"x":12,"y":-0.19936511653774946},{"x":13,"y":-0.1180637196912171},{"x":14,"y":-0.015634118006222053},{"x":15,"y":-0.06916761168765628},{"x":16,"y":-0.15617703456547982},{"x":17,"y":0.009407152335983326},{"x":18,"y":0.13121090169909078},{"x":19,"y":0.12116251995739535},{"x":20,"y":0.03791073419240476},{"x":21,"y":-0.14438355235450384},{"x":22,"y":-0.3085826139234573},{"x":23,"y":-0.11318702145034365},{"x":24,"y":-0.08814408338076873},{"x":25,"y":-0.06429091344678284},{"x":26,"y":0.09680896100735126},{"x":27,"y":-0.0012727702196668744},{"x":28,"y":0.04242312404532811},{"x":29,"y":0.06666381578226499},{"x":30,"y":0.16813670847297768},{"x":31,"y":0.15808832673128226},{"x":32,"y":0.06967087787408044},{"x":33,"y":-0.06771692624421721},{"x":34,"y":-0.18175502150995992},{"x":35,"y":-0.06342223660344715},{"x":36,"y":-0.04379485019902596},{"x":37,"y":-0.002549937553171233},{"x":38,"y":0.05713501871980853},{"x":39,"y":-0.017106520660946423},{"x":40,"y":-0.01616578082704656},{"x":41,"y":0.1487947473789255},{"x":42,"y":0.1923306117713377},{"x":43,"y":0.23314064726313344},{"x":44,"y":0.07648879132956221},{"x":45,"y":-0.023620414330314254},{"x":46,"y":-0.13844774730518683},{"x":47,"y":-0.02813244679700677},{"x":48,"y":-0.027924328371512708},{"x":49,"y":-0.03797271011320813},{"x":50,"y":0.13769605394019013},{"x":51,"y":0.12340138131704315},{"x":52,"y":0.08748948898542874},{"x":53,"y":0.1367805470300416},{"x":54,"y":0.20961982509411392},{"x":55,"y":0.22942440650210116},{"x":56,"y":0.08163409959953949},{"x":57,"y":-0.04461628980122079},{"x":58,"y":-0.21356595412877244},{"x":59,"y":-0.11326627870160255},{"x":60,"y":-0.10849957465815763},{"x":61,"y":-0.200225987414119},{"x":62,"y":0.012869182158395276},{"x":63,"y":-0.03181469624605615},{"x":64,"y":-0.011491980111452804},{"x":65,"y":0.09908762593546605},{"x":66,"y":0.22351715842232434},{"x":67,"y":0.1832143683228269},{"x":68,"y":0.04982143926360205},{"x":69,"y":-0.08333300062339077},{"x":70,"y":-0.213897406877539},{"x":71,"y":-0.10342976410678162},{"x":72,"y":-0.05826242324603026},{"x":73,"y":-0.10621007757871226},{"x":74,"y":0.019951745514142694},{"x":75,"y":0.01736608497403669},{"x":76,"y":0.011028282628877228},{"x":77,"y":0.15513058071443986},{"x":78,"y":0.2896634277838519},{"x":79,"y":0.23178595835227522},{"x":80,"y":0.115415984473203},{"x":81,"y":-0.02450747868990355},{"x":82,"y":-0.17962382568453794},{"x":83,"y":-0.030111234870727976},{"x":84,"y":-0.018806492141854037},{"x":85,"y":-0.05381160585741718},{"x":86,"y":0.07102428009083006},{"x":87,"y":0.04827731501200727},{"x":88,"y":0.05407712551033583},{"x":89,"y":0.20623315840299572},{"x":90,"y":0.2953765722078012},{"x":91,"y":0.2657676646116114},{"x":92,"y":0.12395000523879318},{"x":93,"y":-0.03463106402593752},{"x":94,"y":-0.1661457268403117},{"x":95,"y":-0.054727827509327476},{"x":96,"y":-0.0357886723777705},{"x":97,"y":-0.09129942819622361},{"x":98,"y":0.06647265616523601},{"x":99,"y":0.03369602334598554},{"x":100,"y":0.04356295130523158},{"x":101,"y":0.20640209412413224},{"x":102,"y":0.29338580393378066},{"x":103,"y":0.28762927427362683},{"x":104,"y":0.1326665128241844},{"x":105,"y":-0.029471966931802207},{"x":106,"y":-0.16853335201294506},{"x":107,"y":-0.08178235039884729},{"x":108,"y":-0.07999627449353941},{"x":109,"y":-0.15693889106526537},{"x":110,"y":-0.03739444376136625},{"x":111,"y":-0.08688455755435864},{"x":112,"y":-0.05473258480567722},{"x":113,"y":0.11616223027646111},{"x":114,"y":0.22721194524060184},{"x":115,"y":0.24527786497974624},{"x":116,"y":0.012085931923841109},{"x":117,"y":-0.11605493929072619},{"x":118,"y":-0.27285341204150804},{"x":119,"y":-0.19939116091003406},{"x":120,"y":-0.14341844155393435},{"x":121,"y":-0.2047601176831808},{"x":122,"y":-0.04326607688574846},{"x":123,"y":-0.07825340697469585},{"x":124,"y":-0.0294612886934571},{"x":125,"y":0.07721460387298862},{"x":126,"y":0.21646252349375406},{"x":127,"y":0.2262883279591419},{"x":128,"y":0.027817527148581433},{"x":129,"y":-0.1111447232367535},{"x":130,"y":-0.23836207859527203},{"x":131,"y":-0.13616760505620018},{"x":132,"y":-0.11701683210563285},{"x":133,"y":-0.19144387566076304},{"x":134,"y":-0.13232889746568688},{"x":135,"y":-0.046850156132871135},{"x":136,"y":-0.03331759528566014},{"x":137,"y":0.0819217842830966},{"x":138,"y":0.22254674838457422},{"x":139,"y":0.18643825997301366},{"x":140,"y":-8.660259513959545E-6},{"x":141,"y":-0.10714044658304278},{"x":142,"y":-0.2844401321976946},{"x":143,"y":-0.1922096648189715}]}],"marks":[{"type":"line","from":{"data":"d858dce1-6192-46c4-bbba-46321a47088d"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"#FF29D2"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}}],"scales":[{"name":"x","type":"linear","range":"width","zero":false,"domain":{"data":"d858dce1-6192-46c4-bbba-46321a47088d","field":"data.x"}},{"name":"y","type":"linear","range":"height","nice":true,"zero":false,"domain":{"data":"d858dce1-6192-46c4-bbba-46321a47088d","field":"data.y"}}],"axes":[{"type":"x","scale":"x"},{"type":"y","scale":"y"}]},"value":"#gorilla_repl.vega.VegaView{:content {:width 600, :height 370.8282, :padding {:top 10, :left 55, :bottom 40, :right 10}, :data [{:name \"d858dce1-6192-46c4-bbba-46321a47088d\", :values ({:x 0, :y -0.1052177927055622} {:x 1, :y -0.06308042127668667} {:x 2, :y 0.038988495102323384} {:x 3, :y 0.005950595135929326} {:x 4, :y -0.06811964537069581} {:x 5, :y 0.03131620572929705} {:x 6, :y 0.1132053193132867} {:x 7, :y 0.10315693757159128} {:x 8, :y 0.008551167801833515} {:x 9, :y -0.13502860656438465} {:x 10, :y -0.2798095822762363} {:x 11, :y -0.16356423869363912} {:x 12, :y -0.19936511653774946} {:x 13, :y -0.1180637196912171} {:x 14, :y -0.015634118006222053} {:x 15, :y -0.06916761168765628} {:x 16, :y -0.15617703456547982} {:x 17, :y 0.009407152335983326} {:x 18, :y 0.13121090169909078} {:x 19, :y 0.12116251995739535} {:x 20, :y 0.03791073419240476} {:x 21, :y -0.14438355235450384} {:x 22, :y -0.3085826139234573} {:x 23, :y -0.11318702145034365} {:x 24, :y -0.08814408338076873} {:x 25, :y -0.06429091344678284} {:x 26, :y 0.09680896100735126} {:x 27, :y -0.0012727702196668744} {:x 28, :y 0.04242312404532811} {:x 29, :y 0.06666381578226499} {:x 30, :y 0.16813670847297768} {:x 31, :y 0.15808832673128226} {:x 32, :y 0.06967087787408044} {:x 33, :y -0.06771692624421721} {:x 34, :y -0.18175502150995992} {:x 35, :y -0.06342223660344715} {:x 36, :y -0.04379485019902596} {:x 37, :y -0.002549937553171233} {:x 38, :y 0.05713501871980853} {:x 39, :y -0.017106520660946423} {:x 40, :y -0.01616578082704656} {:x 41, :y 0.1487947473789255} {:x 42, :y 0.1923306117713377} {:x 43, :y 0.23314064726313344} {:x 44, :y 0.07648879132956221} {:x 45, :y -0.023620414330314254} {:x 46, :y -0.13844774730518683} {:x 47, :y -0.02813244679700677} {:x 48, :y -0.027924328371512708} {:x 49, :y -0.03797271011320813} {:x 50, :y 0.13769605394019013} {:x 51, :y 0.12340138131704315} {:x 52, :y 0.08748948898542874} {:x 53, :y 0.1367805470300416} {:x 54, :y 0.20961982509411392} {:x 55, :y 0.22942440650210116} {:x 56, :y 0.08163409959953949} {:x 57, :y -0.04461628980122079} {:x 58, :y -0.21356595412877244} {:x 59, :y -0.11326627870160255} {:x 60, :y -0.10849957465815763} {:x 61, :y -0.200225987414119} {:x 62, :y 0.012869182158395276} {:x 63, :y -0.03181469624605615} {:x 64, :y -0.011491980111452804} {:x 65, :y 0.09908762593546605} {:x 66, :y 0.22351715842232434} {:x 67, :y 0.1832143683228269} {:x 68, :y 0.04982143926360205} {:x 69, :y -0.08333300062339077} {:x 70, :y -0.213897406877539} {:x 71, :y -0.10342976410678162} {:x 72, :y -0.05826242324603026} {:x 73, :y -0.10621007757871226} {:x 74, :y 0.019951745514142694} {:x 75, :y 0.01736608497403669} {:x 76, :y 0.011028282628877228} {:x 77, :y 0.15513058071443986} {:x 78, :y 0.2896634277838519} {:x 79, :y 0.23178595835227522} {:x 80, :y 0.115415984473203} {:x 81, :y -0.02450747868990355} {:x 82, :y -0.17962382568453794} {:x 83, :y -0.030111234870727976} {:x 84, :y -0.018806492141854037} {:x 85, :y -0.05381160585741718} {:x 86, :y 0.07102428009083006} {:x 87, :y 0.04827731501200727} {:x 88, :y 0.05407712551033583} {:x 89, :y 0.20623315840299572} {:x 90, :y 0.2953765722078012} {:x 91, :y 0.2657676646116114} {:x 92, :y 0.12395000523879318} {:x 93, :y -0.03463106402593752} {:x 94, :y -0.1661457268403117} {:x 95, :y -0.054727827509327476} {:x 96, :y -0.0357886723777705} {:x 97, :y -0.09129942819622361} {:x 98, :y 0.06647265616523601} {:x 99, :y 0.03369602334598554} {:x 100, :y 0.04356295130523158} {:x 101, :y 0.20640209412413224} {:x 102, :y 0.29338580393378066} {:x 103, :y 0.28762927427362683} {:x 104, :y 0.1326665128241844} {:x 105, :y -0.029471966931802207} {:x 106, :y -0.16853335201294506} {:x 107, :y -0.08178235039884729} {:x 108, :y -0.07999627449353941} {:x 109, :y -0.15693889106526537} {:x 110, :y -0.03739444376136625} {:x 111, :y -0.08688455755435864} {:x 112, :y -0.05473258480567722} {:x 113, :y 0.11616223027646111} {:x 114, :y 0.22721194524060184} {:x 115, :y 0.24527786497974624} {:x 116, :y 0.012085931923841109} {:x 117, :y -0.11605493929072619} {:x 118, :y -0.27285341204150804} {:x 119, :y -0.19939116091003406} {:x 120, :y -0.14341844155393435} {:x 121, :y -0.2047601176831808} {:x 122, :y -0.04326607688574846} {:x 123, :y -0.07825340697469585} {:x 124, :y -0.0294612886934571} {:x 125, :y 0.07721460387298862} {:x 126, :y 0.21646252349375406} {:x 127, :y 0.2262883279591419} {:x 128, :y 0.027817527148581433} {:x 129, :y -0.1111447232367535} {:x 130, :y -0.23836207859527203} {:x 131, :y -0.13616760505620018} {:x 132, :y -0.11701683210563285} {:x 133, :y -0.19144387566076304} {:x 134, :y -0.13232889746568688} {:x 135, :y -0.046850156132871135} {:x 136, :y -0.03331759528566014} {:x 137, :y 0.0819217842830966} {:x 138, :y 0.22254674838457422} {:x 139, :y 0.18643825997301366} {:x 140, :y -8.660259513959545E-6} {:x 141, :y -0.10714044658304278} {:x 142, :y -0.2844401321976946} {:x 143, :y -0.1922096648189715})}], :marks [{:type \"line\", :from {:data \"d858dce1-6192-46c4-bbba-46321a47088d\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"#FF29D2\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}}], :scales [{:name \"x\", :type \"linear\", :range \"width\", :zero false, :domain {:data \"d858dce1-6192-46c4-bbba-46321a47088d\", :field \"data.x\"}} {:name \"y\", :type \"linear\", :range \"height\", :nice true, :zero false, :domain {:data \"d858dce1-6192-46c4-bbba-46321a47088d\", :field \"data.y\"}}], :axes [{:type \"x\", :scale \"x\"} {:type \"y\", :scale \"y\"}]}}"}
;; <=

;; @@
(defn difference
  [series]
  (map - (drop 1 series) series))
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-var'>#&#x27;ch9.ws/difference</span>","value":"#'ch9.ws/difference"}
;; <=

;; @@
(-> (airline-passengers)
    (i/log)
    (difference)
    (ts-plot))
;; @@
;; =>
;;; {"type":"vega","content":{"width":600,"height":370.82818603515625,"padding":{"top":10,"left":55,"bottom":40,"right":10},"data":[{"name":"04b18c32-0c50-40b5-b251-df2c4d5fe5e6","values":[{"x":0,"y":0.05218575317057095},{"x":1,"y":0.11211729812070548},{"x":2,"y":-0.022989518224698635},{"x":3,"y":-0.0640218587649306},{"x":4,"y":0.10948423284168829},{"x":5,"y":0.09193749532568507},{"x":6,"y":0.0},{"x":7,"y":-0.08455738802806234},{"x":8,"y":-0.13353139262452274},{"x":9,"y":-0.13473259397015713},{"x":10,"y":0.12629372532429262},{"x":11,"y":-0.025752496102414923},{"x":12,"y":0.09134977858822779},{"x":13,"y":0.11247798342669046},{"x":14,"y":-0.04348511193973881},{"x":15,"y":-0.07696104113612812},{"x":16,"y":0.17563256864315768},{"x":17,"y":0.13185213110480287},{"x":18,"y":0.0},{"x":19,"y":-0.07320340402329517},{"x":20,"y":-0.17224590480521318},{"x":21,"y":-0.15415067982725805},{"x":22,"y":0.2054439742148082},{"x":23,"y":0.03509131981127034},{"x":24,"y":0.03390155167568132},{"x":25,"y":0.17114825619582952},{"x":26,"y":-0.08803334948532271},{"x":27,"y":0.053744276006690406},{"x":28,"y":0.034289073478632304},{"x":29,"y":0.11152127443240722},{"x":30,"y":0.0},{"x":31,"y":-0.0783690671155064},{"x":32,"y":-0.12733942237660223},{"x":33,"y":-0.10398971352404729},{"x":34,"y":0.1283811666482073},{"x":35,"y":0.02967576814611661},{"x":36,"y":0.05129329438755015},{"x":37,"y":0.06973333801467518},{"x":38,"y":-0.06419315763905953},{"x":39,"y":0.010989121575595284},{"x":40,"y":0.1750089099476675},{"x":41,"y":0.05358424613410673},{"x":42,"y":0.05085841723349116},{"x":43,"y":-0.1466034741918758},{"x":44,"y":-0.09006082391818104},{"x":45,"y":-0.10477895123317715},{"x":46,"y":0.12036368224987548},{"x":47,"y":0.010256500167188598},{"x":48,"y":0.0},{"x":49,"y":0.18571714579509369},{"x":50,"y":-0.004246290881451564},{"x":51,"y":-0.02586351058991898},{"x":52,"y":0.05933943978630829},{"x":53,"y":0.08288765980576773},{"x":54,"y":0.029852963149681777},{"x":55,"y":-0.13774192516086625},{"x":56,"y":-0.11620200765906485},{"x":57,"y":-0.15890128258585623},{"x":58,"y":0.11034805716886531},{"x":59,"y":0.014815085785140347},{"x":60,"y":-0.08167803101426685},{"x":61,"y":0.2231435513142097},{"x":62,"y":-0.034635496662756005},{"x":63,"y":0.03037109787629877},{"x":64,"y":0.12062798778861428},{"x":65,"y":0.1344779142285537},{"x":66,"y":-0.03025440835780202},{"x":67,"y":-0.1233445473175303},{"x":68,"y":-0.1231060581452974},{"x":69,"y":-0.1205160245124528},{"x":70,"y":0.1205160245124528},{"x":71,"y":0.05521572260244678},{"x":72,"y":-0.03789927259098658},{"x":73,"y":0.1362102048345495},{"x":74,"y":0.007462721201589417},{"x":75,"y":0.0037105793965359624},{"x":76,"y":0.15415067982725805},{"x":77,"y":0.14458122881110747},{"x":78,"y":-0.047829087689881256},{"x":79,"y":-0.1063215921373768},{"x":80,"y":-0.12987508142141202},{"x":81,"y":-0.14506796525293897},{"x":82,"y":0.1595609725555054},{"x":83,"y":0.021353124470569362},{"x":84,"y":-0.02495673197386772},{"x":85,"y":0.13488426768994177},{"x":86,"y":-0.012698583337127367},{"x":87,"y":0.015848192240023984},{"x":88,"y":0.1622044146343553},{"x":89,"y":0.09919179554650093},{"x":90,"y":-0.019560525854494415},{"x":91,"y":-0.13176927763112278},{"x":92,"y":-0.14853268752303528},{"x":93,"y":-0.12146628107267965},{"x":94,"y":0.12146628107267965},{"x":95,"y":0.028987536873252395},{"x":96,"y":-0.04546237407675768},{"x":97,"y":0.16782046610315504},{"x":98,"y":-0.02272825107755594},{"x":99,"y":0.019915309700941464},{"x":100,"y":0.17288752456059608},{"x":101,"y":0.09703209155134385},{"x":102,"y":0.004291852081541592},{"x":103,"y":-0.144914379707747},{"x":104,"y":-0.1520900980142912},{"x":105,"y":-0.12901300333944743},{"x":106,"y":0.0967993833557923},{"x":107,"y":0.011834457647003305},{"x":108,"y":-0.06689423483003054},{"x":109,"y":0.12959282904559455},{"x":110,"y":-0.039441732051296974},{"x":111,"y":0.04220035449037596},{"x":112,"y":0.18094319682383375},{"x":113,"y":0.12109809670583616},{"x":114,"y":0.02811430148083982},{"x":115,"y":-0.2231435513142097},{"x":116,"y":-0.11809248947287188},{"x":117,"y":-0.14675009100908643},{"x":118,"y":0.0835106328731694},{"x":119,"y":0.06602110109779424},{"x":120,"y":-0.051293294387551036},{"x":121,"y":0.17154242253912777},{"x":122,"y":-0.024938948347251966},{"x":123,"y":0.058840500022933284},{"x":124,"y":0.11672427430814114},{"x":125,"y":0.14929630136246086},{"x":126,"y":0.019874186207083255},{"x":127,"y":-0.18842241906886503},{"x":128,"y":-0.12891386864363952},{"x":129,"y":-0.1171689736168231},{"x":130,"y":0.11224285528076727},{"x":131,"y":0.029199154692262752},{"x":132,"y":-0.06437866181343566},{"x":133,"y":0.06916335993677158},{"x":134,"y":0.09552712307451117},{"x":135,"y":0.023580942588906417},{"x":136,"y":0.12528776131045127},{"x":137,"y":0.15067334584317305},{"x":138,"y":-0.026060106669865135},{"x":139,"y":-0.1763985384908322},{"x":140,"y":-0.0970834045818334},{"x":141,"y":-0.1672513038729564},{"x":142,"y":0.10227884912041851}]}],"marks":[{"type":"line","from":{"data":"04b18c32-0c50-40b5-b251-df2c4d5fe5e6"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"#FF29D2"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}}],"scales":[{"name":"x","type":"linear","range":"width","zero":false,"domain":{"data":"04b18c32-0c50-40b5-b251-df2c4d5fe5e6","field":"data.x"}},{"name":"y","type":"linear","range":"height","nice":true,"zero":false,"domain":{"data":"04b18c32-0c50-40b5-b251-df2c4d5fe5e6","field":"data.y"}}],"axes":[{"type":"x","scale":"x"},{"type":"y","scale":"y"}]},"value":"#gorilla_repl.vega.VegaView{:content {:width 600, :height 370.8282, :padding {:top 10, :left 55, :bottom 40, :right 10}, :data [{:name \"04b18c32-0c50-40b5-b251-df2c4d5fe5e6\", :values ({:x 0, :y 0.05218575317057095} {:x 1, :y 0.11211729812070548} {:x 2, :y -0.022989518224698635} {:x 3, :y -0.0640218587649306} {:x 4, :y 0.10948423284168829} {:x 5, :y 0.09193749532568507} {:x 6, :y 0.0} {:x 7, :y -0.08455738802806234} {:x 8, :y -0.13353139262452274} {:x 9, :y -0.13473259397015713} {:x 10, :y 0.12629372532429262} {:x 11, :y -0.025752496102414923} {:x 12, :y 0.09134977858822779} {:x 13, :y 0.11247798342669046} {:x 14, :y -0.04348511193973881} {:x 15, :y -0.07696104113612812} {:x 16, :y 0.17563256864315768} {:x 17, :y 0.13185213110480287} {:x 18, :y 0.0} {:x 19, :y -0.07320340402329517} {:x 20, :y -0.17224590480521318} {:x 21, :y -0.15415067982725805} {:x 22, :y 0.2054439742148082} {:x 23, :y 0.03509131981127034} {:x 24, :y 0.03390155167568132} {:x 25, :y 0.17114825619582952} {:x 26, :y -0.08803334948532271} {:x 27, :y 0.053744276006690406} {:x 28, :y 0.034289073478632304} {:x 29, :y 0.11152127443240722} {:x 30, :y 0.0} {:x 31, :y -0.0783690671155064} {:x 32, :y -0.12733942237660223} {:x 33, :y -0.10398971352404729} {:x 34, :y 0.1283811666482073} {:x 35, :y 0.02967576814611661} {:x 36, :y 0.05129329438755015} {:x 37, :y 0.06973333801467518} {:x 38, :y -0.06419315763905953} {:x 39, :y 0.010989121575595284} {:x 40, :y 0.1750089099476675} {:x 41, :y 0.05358424613410673} {:x 42, :y 0.05085841723349116} {:x 43, :y -0.1466034741918758} {:x 44, :y -0.09006082391818104} {:x 45, :y -0.10477895123317715} {:x 46, :y 0.12036368224987548} {:x 47, :y 0.010256500167188598} {:x 48, :y 0.0} {:x 49, :y 0.18571714579509369} {:x 50, :y -0.004246290881451564} {:x 51, :y -0.02586351058991898} {:x 52, :y 0.05933943978630829} {:x 53, :y 0.08288765980576773} {:x 54, :y 0.029852963149681777} {:x 55, :y -0.13774192516086625} {:x 56, :y -0.11620200765906485} {:x 57, :y -0.15890128258585623} {:x 58, :y 0.11034805716886531} {:x 59, :y 0.014815085785140347} {:x 60, :y -0.08167803101426685} {:x 61, :y 0.2231435513142097} {:x 62, :y -0.034635496662756005} {:x 63, :y 0.03037109787629877} {:x 64, :y 0.12062798778861428} {:x 65, :y 0.1344779142285537} {:x 66, :y -0.03025440835780202} {:x 67, :y -0.1233445473175303} {:x 68, :y -0.1231060581452974} {:x 69, :y -0.1205160245124528} {:x 70, :y 0.1205160245124528} {:x 71, :y 0.05521572260244678} {:x 72, :y -0.03789927259098658} {:x 73, :y 0.1362102048345495} {:x 74, :y 0.007462721201589417} {:x 75, :y 0.0037105793965359624} {:x 76, :y 0.15415067982725805} {:x 77, :y 0.14458122881110747} {:x 78, :y -0.047829087689881256} {:x 79, :y -0.1063215921373768} {:x 80, :y -0.12987508142141202} {:x 81, :y -0.14506796525293897} {:x 82, :y 0.1595609725555054} {:x 83, :y 0.021353124470569362} {:x 84, :y -0.02495673197386772} {:x 85, :y 0.13488426768994177} {:x 86, :y -0.012698583337127367} {:x 87, :y 0.015848192240023984} {:x 88, :y 0.1622044146343553} {:x 89, :y 0.09919179554650093} {:x 90, :y -0.019560525854494415} {:x 91, :y -0.13176927763112278} {:x 92, :y -0.14853268752303528} {:x 93, :y -0.12146628107267965} {:x 94, :y 0.12146628107267965} {:x 95, :y 0.028987536873252395} {:x 96, :y -0.04546237407675768} {:x 97, :y 0.16782046610315504} {:x 98, :y -0.02272825107755594} {:x 99, :y 0.019915309700941464} {:x 100, :y 0.17288752456059608} {:x 101, :y 0.09703209155134385} {:x 102, :y 0.004291852081541592} {:x 103, :y -0.144914379707747} {:x 104, :y -0.1520900980142912} {:x 105, :y -0.12901300333944743} {:x 106, :y 0.0967993833557923} {:x 107, :y 0.011834457647003305} {:x 108, :y -0.06689423483003054} {:x 109, :y 0.12959282904559455} {:x 110, :y -0.039441732051296974} {:x 111, :y 0.04220035449037596} {:x 112, :y 0.18094319682383375} {:x 113, :y 0.12109809670583616} {:x 114, :y 0.02811430148083982} {:x 115, :y -0.2231435513142097} {:x 116, :y -0.11809248947287188} {:x 117, :y -0.14675009100908643} {:x 118, :y 0.0835106328731694} {:x 119, :y 0.06602110109779424} {:x 120, :y -0.051293294387551036} {:x 121, :y 0.17154242253912777} {:x 122, :y -0.024938948347251966} {:x 123, :y 0.058840500022933284} {:x 124, :y 0.11672427430814114} {:x 125, :y 0.14929630136246086} {:x 126, :y 0.019874186207083255} {:x 127, :y -0.18842241906886503} {:x 128, :y -0.12891386864363952} {:x 129, :y -0.1171689736168231} {:x 130, :y 0.11224285528076727} {:x 131, :y 0.029199154692262752} {:x 132, :y -0.06437866181343566} {:x 133, :y 0.06916335993677158} {:x 134, :y 0.09552712307451117} {:x 135, :y 0.023580942588906417} {:x 136, :y 0.12528776131045127} {:x 137, :y 0.15067334584317305} {:x 138, :y -0.026060106669865135} {:x 139, :y -0.1763985384908322} {:x 140, :y -0.0970834045818334} {:x 141, :y -0.1672513038729564} {:x 142, :y 0.10227884912041851})}], :marks [{:type \"line\", :from {:data \"04b18c32-0c50-40b5-b251-df2c4d5fe5e6\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"#FF29D2\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}}], :scales [{:name \"x\", :type \"linear\", :range \"width\", :zero false, :domain {:data \"04b18c32-0c50-40b5-b251-df2c4d5fe5e6\", :field \"data.x\"}} {:name \"y\", :type \"linear\", :range \"height\", :nice true, :zero false, :domain {:data \"04b18c32-0c50-40b5-b251-df2c4d5fe5e6\", :field \"data.y\"}}], :axes [{:type \"x\", :scale \"x\"} {:type \"y\", :scale \"y\"}]}}"}
;; <=

;; **
;;; ## Random walk
;; **

;; @@
(defn constant-series
  [y]
  (cons y (lazy-seq (constant-series y))))
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-var'>#&#x27;ch9.ws/constant-series</span>","value":"#'ch9.ws/constant-series"}
;; <=

;; @@
(take 5 (constant-series 42))
;; @@
;; =>
;;; {"type":"list-like","open":"<span class='clj-lazy-seq'>(</span>","close":"<span class='clj-lazy-seq'>)</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-long'>42</span>","value":"42"},{"type":"html","content":"<span class='clj-long'>42</span>","value":"42"},{"type":"html","content":"<span class='clj-long'>42</span>","value":"42"},{"type":"html","content":"<span class='clj-long'>42</span>","value":"42"},{"type":"html","content":"<span class='clj-long'>42</span>","value":"42"}],"value":"(42 42 42 42 42)"}
;; <=

;; @@
(defn random-walk
  [y]
  (let [e (s/sample-normal 1)
        y (+ y e)]
    (cons y (lazy-seq (random-walk y)))))
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-var'>#&#x27;ch9.ws/random-walk</span>","value":"#'ch9.ws/random-walk"}
;; <=

;; @@
(->> (random-walk 0)
     (take 50)
     (ts-plot))
;; @@
;; =>
;;; {"type":"vega","content":{"width":600,"height":370.82818603515625,"padding":{"top":10,"left":55,"bottom":40,"right":10},"data":[{"name":"8ddc8653-0af9-4024-8230-6c68898a0534","values":[{"x":0,"y":1.1374019523097163},{"x":1,"y":-0.8538704800163546},{"x":2,"y":-0.13133013954610906},{"x":3,"y":-1.2427163358532316},{"x":4,"y":-0.8654057246727793},{"x":5,"y":-0.18234910428364315},{"x":6,"y":0.07997678444201634},{"x":7,"y":-0.5139275041895988},{"x":8,"y":-0.21739958867527864},{"x":9,"y":-0.5070987786997891},{"x":10,"y":-1.0408194909139494},{"x":11,"y":0.6831292158642943},{"x":12,"y":0.10377974091999409},{"x":13,"y":0.6370255151558221},{"x":14,"y":1.1369533106541216},{"x":15,"y":0.40702224723675917},{"x":16,"y":2.7116814641133056},{"x":17,"y":2.505835416716409},{"x":18,"y":3.238912654596807},{"x":19,"y":4.0053126210330845},{"x":20,"y":4.41207046964789},{"x":21,"y":4.862170400855818},{"x":22,"y":5.942988459318833},{"x":23,"y":6.741633840344253},{"x":24,"y":7.1340808707178125},{"x":25,"y":7.20130268733305},{"x":26,"y":7.394807120406045},{"x":27,"y":7.077168385698516},{"x":28,"y":6.585941578760721},{"x":29,"y":6.873382776950081},{"x":30,"y":6.150961198785506},{"x":31,"y":4.894791621786284},{"x":32,"y":6.877480611131394},{"x":33,"y":7.480813381156849},{"x":34,"y":7.510104728410601},{"x":35,"y":8.181694968795213},{"x":36,"y":8.984047258225475},{"x":37,"y":7.930709934695287},{"x":38,"y":8.016669890457072},{"x":39,"y":10.12225159618468},{"x":40,"y":10.757522911083532},{"x":41,"y":8.631044389092107},{"x":42,"y":7.407103852679755},{"x":43,"y":7.896323470334906},{"x":44,"y":8.89264139008557},{"x":45,"y":9.569154309063238},{"x":46,"y":8.857636557673413},{"x":47,"y":7.5046404027752605},{"x":48,"y":7.876944046897794},{"x":49,"y":9.339307271882369}]}],"marks":[{"type":"line","from":{"data":"8ddc8653-0af9-4024-8230-6c68898a0534"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"#FF29D2"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}}],"scales":[{"name":"x","type":"linear","range":"width","zero":false,"domain":{"data":"8ddc8653-0af9-4024-8230-6c68898a0534","field":"data.x"}},{"name":"y","type":"linear","range":"height","nice":true,"zero":false,"domain":{"data":"8ddc8653-0af9-4024-8230-6c68898a0534","field":"data.y"}}],"axes":[{"type":"x","scale":"x"},{"type":"y","scale":"y"}]},"value":"#gorilla_repl.vega.VegaView{:content {:width 600, :height 370.8282, :padding {:top 10, :left 55, :bottom 40, :right 10}, :data [{:name \"8ddc8653-0af9-4024-8230-6c68898a0534\", :values ({:x 0, :y 1.1374019523097163} {:x 1, :y -0.8538704800163546} {:x 2, :y -0.13133013954610906} {:x 3, :y -1.2427163358532316} {:x 4, :y -0.8654057246727793} {:x 5, :y -0.18234910428364315} {:x 6, :y 0.07997678444201634} {:x 7, :y -0.5139275041895988} {:x 8, :y -0.21739958867527864} {:x 9, :y -0.5070987786997891} {:x 10, :y -1.0408194909139494} {:x 11, :y 0.6831292158642943} {:x 12, :y 0.10377974091999409} {:x 13, :y 0.6370255151558221} {:x 14, :y 1.1369533106541216} {:x 15, :y 0.40702224723675917} {:x 16, :y 2.7116814641133056} {:x 17, :y 2.505835416716409} {:x 18, :y 3.238912654596807} {:x 19, :y 4.0053126210330845} {:x 20, :y 4.41207046964789} {:x 21, :y 4.862170400855818} {:x 22, :y 5.942988459318833} {:x 23, :y 6.741633840344253} {:x 24, :y 7.1340808707178125} {:x 25, :y 7.20130268733305} {:x 26, :y 7.394807120406045} {:x 27, :y 7.077168385698516} {:x 28, :y 6.585941578760721} {:x 29, :y 6.873382776950081} {:x 30, :y 6.150961198785506} {:x 31, :y 4.894791621786284} {:x 32, :y 6.877480611131394} {:x 33, :y 7.480813381156849} {:x 34, :y 7.510104728410601} {:x 35, :y 8.181694968795213} {:x 36, :y 8.984047258225475} {:x 37, :y 7.930709934695287} {:x 38, :y 8.016669890457072} {:x 39, :y 10.12225159618468} {:x 40, :y 10.757522911083532} {:x 41, :y 8.631044389092107} {:x 42, :y 7.407103852679755} {:x 43, :y 7.896323470334906} {:x 44, :y 8.89264139008557} {:x 45, :y 9.569154309063238} {:x 46, :y 8.857636557673413} {:x 47, :y 7.5046404027752605} {:x 48, :y 7.876944046897794} {:x 49, :y 9.339307271882369})}], :marks [{:type \"line\", :from {:data \"8ddc8653-0af9-4024-8230-6c68898a0534\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"#FF29D2\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}}], :scales [{:name \"x\", :type \"linear\", :range \"width\", :zero false, :domain {:data \"8ddc8653-0af9-4024-8230-6c68898a0534\", :field \"data.x\"}} {:name \"y\", :type \"linear\", :range \"height\", :nice true, :zero false, :domain {:data \"8ddc8653-0af9-4024-8230-6c68898a0534\", :field \"data.y\"}}], :axes [{:type \"x\", :scale \"x\"} {:type \"y\", :scale \"y\"}]}}"}
;; <=

;; **
;;; ## Autoregressive models
;; **

;; @@
(defn ar
  [ys coefs sigma]
  (let [e (s/sample-normal 1 :sd sigma)
        y (apply + e (map * ys coefs))]
    (cons y (lazy-seq
              (ar (cons y ys) coefs sigma)))))
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-var'>#&#x27;ch9.ws/ar</span>","value":"#'ch9.ws/ar"}
;; <=

;; @@
(->> (ar [1] [2] 0)
     (take 10)
     (ts-plot))
;; @@
;; =>
;;; {"type":"vega","content":{"width":600,"height":370.82818603515625,"padding":{"top":10,"left":55,"bottom":40,"right":10},"data":[{"name":"db587459-a39e-486f-a89e-db52bf5b0c5b","values":[{"x":0,"y":2.0},{"x":1,"y":4.0},{"x":2,"y":8.0},{"x":3,"y":16.0},{"x":4,"y":32.0},{"x":5,"y":64.0},{"x":6,"y":128.0},{"x":7,"y":256.0},{"x":8,"y":512.0},{"x":9,"y":1024.0}]}],"marks":[{"type":"line","from":{"data":"db587459-a39e-486f-a89e-db52bf5b0c5b"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"#FF29D2"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}}],"scales":[{"name":"x","type":"linear","range":"width","zero":false,"domain":{"data":"db587459-a39e-486f-a89e-db52bf5b0c5b","field":"data.x"}},{"name":"y","type":"linear","range":"height","nice":true,"zero":false,"domain":{"data":"db587459-a39e-486f-a89e-db52bf5b0c5b","field":"data.y"}}],"axes":[{"type":"x","scale":"x"},{"type":"y","scale":"y"}]},"value":"#gorilla_repl.vega.VegaView{:content {:width 600, :height 370.8282, :padding {:top 10, :left 55, :bottom 40, :right 10}, :data [{:name \"db587459-a39e-486f-a89e-db52bf5b0c5b\", :values ({:x 0, :y 2.0} {:x 1, :y 4.0} {:x 2, :y 8.0} {:x 3, :y 16.0} {:x 4, :y 32.0} {:x 5, :y 64.0} {:x 6, :y 128.0} {:x 7, :y 256.0} {:x 8, :y 512.0} {:x 9, :y 1024.0})}], :marks [{:type \"line\", :from {:data \"db587459-a39e-486f-a89e-db52bf5b0c5b\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"#FF29D2\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}}], :scales [{:name \"x\", :type \"linear\", :range \"width\", :zero false, :domain {:data \"db587459-a39e-486f-a89e-db52bf5b0c5b\", :field \"data.x\"}} {:name \"y\", :type \"linear\", :range \"height\", :nice true, :zero false, :domain {:data \"db587459-a39e-486f-a89e-db52bf5b0c5b\", :field \"data.y\"}}], :axes [{:type \"x\", :scale \"x\"} {:type \"y\", :scale \"y\"}]}}"}
;; <=

;; @@
(let [init (s/sample-normal 5)]
  (->> (ar init [0 0 0 0 1] 0)
       (take 30)
       (ts-plot)))
;; @@
;; =>
;;; {"type":"vega","content":{"width":600,"height":370.82818603515625,"padding":{"top":10,"left":55,"bottom":40,"right":10},"data":[{"name":"c494595b-9271-48e7-8450-0e32e51c8011","values":[{"x":0,"y":-0.6067786395253691},{"x":1,"y":-0.21278362934520414},{"x":2,"y":0.9891607640588665},{"x":3,"y":0.6016934512450973},{"x":4,"y":0.21398960891473007},{"x":5,"y":-0.6067786395253691},{"x":6,"y":-0.21278362934520414},{"x":7,"y":0.9891607640588665},{"x":8,"y":0.6016934512450973},{"x":9,"y":0.21398960891473007},{"x":10,"y":-0.6067786395253691},{"x":11,"y":-0.21278362934520414},{"x":12,"y":0.9891607640588665},{"x":13,"y":0.6016934512450973},{"x":14,"y":0.21398960891473007},{"x":15,"y":-0.6067786395253691},{"x":16,"y":-0.21278362934520414},{"x":17,"y":0.9891607640588665},{"x":18,"y":0.6016934512450973},{"x":19,"y":0.21398960891473007},{"x":20,"y":-0.6067786395253691},{"x":21,"y":-0.21278362934520414},{"x":22,"y":0.9891607640588665},{"x":23,"y":0.6016934512450973},{"x":24,"y":0.21398960891473007},{"x":25,"y":-0.6067786395253691},{"x":26,"y":-0.21278362934520414},{"x":27,"y":0.9891607640588665},{"x":28,"y":0.6016934512450973},{"x":29,"y":0.21398960891473007}]}],"marks":[{"type":"line","from":{"data":"c494595b-9271-48e7-8450-0e32e51c8011"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"#FF29D2"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}}],"scales":[{"name":"x","type":"linear","range":"width","zero":false,"domain":{"data":"c494595b-9271-48e7-8450-0e32e51c8011","field":"data.x"}},{"name":"y","type":"linear","range":"height","nice":true,"zero":false,"domain":{"data":"c494595b-9271-48e7-8450-0e32e51c8011","field":"data.y"}}],"axes":[{"type":"x","scale":"x"},{"type":"y","scale":"y"}]},"value":"#gorilla_repl.vega.VegaView{:content {:width 600, :height 370.8282, :padding {:top 10, :left 55, :bottom 40, :right 10}, :data [{:name \"c494595b-9271-48e7-8450-0e32e51c8011\", :values ({:x 0, :y -0.6067786395253691} {:x 1, :y -0.21278362934520414} {:x 2, :y 0.9891607640588665} {:x 3, :y 0.6016934512450973} {:x 4, :y 0.21398960891473007} {:x 5, :y -0.6067786395253691} {:x 6, :y -0.21278362934520414} {:x 7, :y 0.9891607640588665} {:x 8, :y 0.6016934512450973} {:x 9, :y 0.21398960891473007} {:x 10, :y -0.6067786395253691} {:x 11, :y -0.21278362934520414} {:x 12, :y 0.9891607640588665} {:x 13, :y 0.6016934512450973} {:x 14, :y 0.21398960891473007} {:x 15, :y -0.6067786395253691} {:x 16, :y -0.21278362934520414} {:x 17, :y 0.9891607640588665} {:x 18, :y 0.6016934512450973} {:x 19, :y 0.21398960891473007} {:x 20, :y -0.6067786395253691} {:x 21, :y -0.21278362934520414} {:x 22, :y 0.9891607640588665} {:x 23, :y 0.6016934512450973} {:x 24, :y 0.21398960891473007} {:x 25, :y -0.6067786395253691} {:x 26, :y -0.21278362934520414} {:x 27, :y 0.9891607640588665} {:x 28, :y 0.6016934512450973} {:x 29, :y 0.21398960891473007})}], :marks [{:type \"line\", :from {:data \"c494595b-9271-48e7-8450-0e32e51c8011\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"#FF29D2\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}}], :scales [{:name \"x\", :type \"linear\", :range \"width\", :zero false, :domain {:data \"c494595b-9271-48e7-8450-0e32e51c8011\", :field \"data.x\"}} {:name \"y\", :type \"linear\", :range \"height\", :nice true, :zero false, :domain {:data \"c494595b-9271-48e7-8450-0e32e51c8011\", :field \"data.y\"}}], :axes [{:type \"x\", :scale \"x\"} {:type \"y\", :scale \"y\"}]}}"}
;; <=

;; @@
(let [init (s/sample-normal 5)]
  (->> (ar init [0 0 0 0 1] 0.2)
       (take 30)
       (ts-plot)))
;; @@
;; =>
;;; {"type":"vega","content":{"width":600,"height":370.82818603515625,"padding":{"top":10,"left":55,"bottom":40,"right":10},"data":[{"name":"40dba7e5-33ac-406a-90fe-767e6b4ff767","values":[{"x":0,"y":0.4923457477934401},{"x":1,"y":1.9671073509627588},{"x":2,"y":-0.4634189636008419},{"x":3,"y":2.1696050782536984},{"x":4,"y":0.9814596072193048},{"x":5,"y":0.5970259923939527},{"x":6,"y":1.928651085503794},{"x":7,"y":-0.1656512553631888},{"x":8,"y":2.076419729601538},{"x":9,"y":1.1296184606750876},{"x":10,"y":0.44018436733796534},{"x":11,"y":1.97525596337972},{"x":12,"y":-0.31583593236940954},{"x":13,"y":2.32631794775834},{"x":14,"y":1.2021488103517572},{"x":15,"y":0.6553976760595042},{"x":16,"y":2.0678547120772426},{"x":17,"y":0.06377115838841146},{"x":18,"y":2.59691833394477},{"x":19,"y":0.9115266568681628},{"x":20,"y":0.6870681036174526},{"x":21,"y":1.9572397454097261},{"x":22,"y":0.19169819959953066},{"x":23,"y":2.658630232421895},{"x":24,"y":0.9452021046055766},{"x":25,"y":0.8590227767892746},{"x":26,"y":2.4110068003800382},{"x":27,"y":0.6292282030262919},{"x":28,"y":2.7834092990366837},{"x":29,"y":0.7686943395201042}]}],"marks":[{"type":"line","from":{"data":"40dba7e5-33ac-406a-90fe-767e6b4ff767"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"#FF29D2"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}}],"scales":[{"name":"x","type":"linear","range":"width","zero":false,"domain":{"data":"40dba7e5-33ac-406a-90fe-767e6b4ff767","field":"data.x"}},{"name":"y","type":"linear","range":"height","nice":true,"zero":false,"domain":{"data":"40dba7e5-33ac-406a-90fe-767e6b4ff767","field":"data.y"}}],"axes":[{"type":"x","scale":"x"},{"type":"y","scale":"y"}]},"value":"#gorilla_repl.vega.VegaView{:content {:width 600, :height 370.8282, :padding {:top 10, :left 55, :bottom 40, :right 10}, :data [{:name \"40dba7e5-33ac-406a-90fe-767e6b4ff767\", :values ({:x 0, :y 0.4923457477934401} {:x 1, :y 1.9671073509627588} {:x 2, :y -0.4634189636008419} {:x 3, :y 2.1696050782536984} {:x 4, :y 0.9814596072193048} {:x 5, :y 0.5970259923939527} {:x 6, :y 1.928651085503794} {:x 7, :y -0.1656512553631888} {:x 8, :y 2.076419729601538} {:x 9, :y 1.1296184606750876} {:x 10, :y 0.44018436733796534} {:x 11, :y 1.97525596337972} {:x 12, :y -0.31583593236940954} {:x 13, :y 2.32631794775834} {:x 14, :y 1.2021488103517572} {:x 15, :y 0.6553976760595042} {:x 16, :y 2.0678547120772426} {:x 17, :y 0.06377115838841146} {:x 18, :y 2.59691833394477} {:x 19, :y 0.9115266568681628} {:x 20, :y 0.6870681036174526} {:x 21, :y 1.9572397454097261} {:x 22, :y 0.19169819959953066} {:x 23, :y 2.658630232421895} {:x 24, :y 0.9452021046055766} {:x 25, :y 0.8590227767892746} {:x 26, :y 2.4110068003800382} {:x 27, :y 0.6292282030262919} {:x 28, :y 2.7834092990366837} {:x 29, :y 0.7686943395201042})}], :marks [{:type \"line\", :from {:data \"40dba7e5-33ac-406a-90fe-767e6b4ff767\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"#FF29D2\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}}], :scales [{:name \"x\", :type \"linear\", :range \"width\", :zero false, :domain {:data \"40dba7e5-33ac-406a-90fe-767e6b4ff767\", :field \"data.x\"}} {:name \"y\", :type \"linear\", :range \"height\", :nice true, :zero false, :domain {:data \"40dba7e5-33ac-406a-90fe-767e6b4ff767\", :field \"data.y\"}}], :axes [{:type \"x\", :scale \"x\"} {:type \"y\", :scale \"y\"}]}}"}
;; <=

;; @@

;; @@
